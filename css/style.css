/* ===========================================================
   css/style.css
   Gemensam styling för index.html, character.html & notes.html
   Optimerad 2025-06-19
   =========================================================== */

/* ---------- Färgpalett ---------- */
:root {
  /* Bas */
  --bg:          #2D2C21;
  --panel:       #26211D;
  --border:      #3A312A;
  --card:        #231E1A;
  --card-border: #3E342E;

  /* Typografi */
  --txt:         #FFF3E4;  /* text / ikoner */
  --subtxt:      #BCAE9E;

  /* Acent / highlights */
  --accent:      #B97A52;

  /* Taggar, chips, småkontroller */
  --tag-interactive-bg:     #4A3A2F;
  --tag-interactive-border: #6A443B;
  --tag-interactive-text:   #EBDDC8;
  --entry-tag-row:          1.35rem;

  /* XP / status-piller */
  --xp-pill-bg:             #3A3029;
  --xp-pill-border:         #5A4A40;
  --xp-pill-text:           #F3E8D8;

  /* Semantiska färger i samma tonvärld */
  --mystic:      #A88FCC;   /* nedtonad lila, passar brun bas */
  --quality:     #C2A36A;   /* varm guldbetonad status */
  --neutral:     #9CB69A;   /* mild grön för neutralt/ok */
  --hilight:     #57ff4b75;   /* mild grön för highlightande av knappar */
  --negative:    #8B4513;   /* bränd sienna */

  /* Fara / CTA */
  --danger:      #ee6b61;
  --danger-bg:   #3B1C1C;

  /* Skugga och kontroller */
  --shadow:      0 4px 16px #0007;
  --ctrl-btn-size:       40px;
  --ctrl-btn-font-size:  1.35rem;

  /* Verktygskanter och knappar enligt kitet */
  --toolborder:        #6A443B;
  --button-standard:   #6A443B;
  --button-cta:        #8B0000;
  --text-icons:        #E0D2C0;
}

@media (max-width: 640px) {
  :root {
    --ctrl-btn-size: 36px;
    --ctrl-btn-font-size: 1.1rem;
  }
}

/* ---------- Reset & grund ---------- */
* { box-sizing: border-box; }
html, body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--txt);
  font-family: system-ui, sans-serif;
  line-height: 1.5;
}

/* Subtle highlight for search matches */
mark {
  /* Soft, slightly more visible yellow highlight */
  background: rgba(255, 229, 138, .24);
  color: inherit;
  padding: 0 .08em;
  border-radius: .25rem;
  box-shadow: inset 0 0 0 1px rgba(255, 229, 138, .36);
}
/* Keep it cohesive in key surfaces */
.card mark,
#yrkePanel mark,
#infoPanel mark,
#tabellPopup mark {
  background: rgba(255, 229, 138, .24);
  box-shadow: inset 0 0 0 1px rgba(255, 229, 138, .36);
}
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-bottom: 90px;        /* plats för toolbar */
}

body.no-scroll {
  position: fixed;
  overflow: hidden;
  width: 100%;
}

shared-toolbar {
  display: block;
}

/* ---------- Generella komponenter ---------- */
h1, h2, h3 { margin: 0 0 .8rem; font-weight: 700; }

.app-title {
  margin: 1.2rem 0 .6rem;
  font-size: 2.4rem;
  letter-spacing: .03em;
  text-align: center;
}

.tags        { display: flex; flex-wrap: wrap; gap: .4rem; }
#activeFilters {
  display: flex;
  flex-wrap: wrap;
  gap: .4rem;
  justify-content: center;
  width: 100%;
  max-width: 520px;
  margin: 0 auto 1rem;
}
.tag         { background: var(--border); color: var(--subtxt);
               padding: .15rem .7rem; border-radius: .55rem;
               font-size: .85rem; white-space: nowrap; }
.tag.removable { cursor: pointer; }
.filter-tag { cursor: pointer; }
.tag.filter-tag {
  background: var(--tag-interactive-bg);
  color: var(--tag-interactive-text);
  border: 1px solid var(--tag-interactive-border);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .04), 0 1px 2px rgba(0, 0, 0, .35);
  text-shadow: 0 1px 1px rgba(0, 0, 0, .35);
}
.tag.filter-tag:hover {
  opacity: .9;
}
.tag.free { background: var(--accent); color:#fff; }

.tag.price-mult {
  background: var(--tag-interactive-bg);
  border: 1px solid var(--tag-interactive-border);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .04), 0 1px 3px rgba(0, 0, 0, .45);
  color: var(--tag-interactive-text);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  font-weight: 600;
  line-height: 1.2;
  padding: .2rem .65rem;
  text-shadow: 0 1px 1px rgba(0, 0, 0, .35);
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
}

.tag.price-mult:hover,
.tag.price-mult:focus-visible {
  filter: brightness(1.05);
  box-shadow: 0 0 0 1px rgba(255, 255, 255, .25), 0 4px 10px rgba(0, 0, 0, .45);
  transform: translateY(-1px);
  outline: none;
}

.tag.price-mult:focus-visible {
  box-shadow: 0 0 0 2px rgba(255, 229, 138, .45), 0 4px 10px rgba(0, 0, 0, .5);
}

.tag.price-mult:active {
  filter: brightness(.95);
  transform: scale(.97);
}
.tag.quality   { border: 1.5px solid var(--quality); }
.tag.mystic    { border: 1.5px solid var(--mystic); }
.tag.neutral   { border: 1.5px solid var(--neutral); }
.tag.negative  { border: 1.5px solid var(--negative); }
.tag.unbound   { border: 1.5px solid #e68181; }

.char-btn,
.toolbar button,
.toolbar a {
  padding: .55rem 1.1rem;
  border: none;
  border-radius: .6rem;
  background: var(--accent);
  color: #fff;
  cursor: pointer;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  transition: transform .1s ease, opacity .1s ease;
}
.char-btn.danger { background: var(--danger); }

.char-btn.icon { gap: .35rem; }

.btn-icon {
  width: 1.8rem;
  height: 1.8rem;
  max-width: 100%;
  max-height: 100%;
  display: block;
  pointer-events: none;
  object-fit: contain;
}

.char-btn.icon .btn-icon {
  width: 1.8rem;
  height: 1.8rem;
}

.char-btn.icon-only {
  padding: .35rem;
}

.char-btn.icon-only .btn-icon {
  width: 2rem;
  height: 2rem;
}

.party-toggle .btn-icon {
  width: 1.85rem;
  height: 1.85rem;
}

.mini-btn .btn-icon {
  width: 1.55rem;
  height: 1.55rem;
}

.icon-only {
  font-size: 0 !important;
  line-height: 0;
}
.char-btn.icon   { font-size: 1.1rem; }
.char-btn:hover  { opacity: .85; }
.char-btn:active { transform: scale(.95); opacity: .7; }

/* Visual cue for programmatic focus/highlight on buttons/links */
.focus-highlight {
  position: relative;
  animation: focusGreenHold 3s cubic-bezier(.25,.8,.25,1) 1;
  outline: 2px solid transparent; /* avoid layout shift */
  animation-fill-mode: both;
}
@keyframes focusGreenHold {
  0%   {background: var(--hilight); transform: none; }
  20%  { background: var(--hilight); transform: scale(1.0035); }
  40%  { background: var(--hilight); transform: none; }
  60%  { background: var(--hilight); transform: scale(1.0035); }
  86%  { background: var(--hilight); transform: none; }
  100% { background: var(--accent);  transform: none; }
}

.hidden { display: none; }

/* Knapp för översiktsmeny */
.summary-btn {
  margin-left: auto;
}

/* Innehåll i översiktspanel */
.summary-content {
  display: flex;
  flex-direction: column;
  gap: 1.2rem;
}

.summary-section {
  display: flex;
  flex-direction: column;
  gap: .7rem;
}

.summary-section h3 {
  margin: 0;
  font-size: 1rem;
  font-weight: 600;
}

.summary-section ul {
  list-style: none;
  margin: 0;
  padding: 0;
}

#summaryPanel .summary-section,
.summary-panel .summary-section,
#effectsPanel .summary-section,
.effects-panel .summary-section,
#infoPanel .summary-section,
#yrkePanel .summary-section {
  background: rgba(255, 255, 255, .04);
  border: 1px solid var(--border);
  border-radius: .85rem;
  padding: .95rem 1.05rem;
}

#yrkePanel .info-panel-section,
#infoPanel .info-panel-section {
  background: none;
  border: 0;
  border-radius: 0;
  box-shadow: none;
  padding: 0;
  gap: .45rem;
}

#yrkePanel .info-panel-section:not(:last-child),
#infoPanel .info-panel-section:not(:last-child) {
  margin-bottom: .45rem;
}

#summaryPanel .summary-section:not(:last-child),
.summary-panel .summary-section:not(:last-child),
#effectsPanel .summary-section:not(:last-child),
.effects-panel .summary-section:not(:last-child),
#infoPanel .summary-section:not(:last-child),
#yrkePanel .summary-section:not(:last-child) {
  margin-bottom: .6rem;
}

#summaryPanel .summary-section h3,
.summary-panel .summary-section h3,
#effectsPanel .summary-section h3,
.effects-panel .summary-section h3,
#infoPanel .summary-section h3,
#yrkePanel .summary-section h3 {
  text-transform: uppercase;
  letter-spacing: .04em;
  font-size: .95rem;
  color: var(--accent);
}

.summary-list {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}

.summary-pairs li {
  position: relative;
  display: grid;
  grid-template-columns: minmax(0, fit-content(18ch)) minmax(0, 1fr);
  column-gap: 1.2rem;
  row-gap: .35rem;
  font-size: .95rem;
  align-items: start;
  padding: .7rem .85rem .7rem 1.25rem;
  border-radius: .75rem;
  border: 1px solid rgba(255, 255, 255, .05);
  background: rgba(255, 255, 255, .02);
}

.summary-pairs li.layout-stack {
  grid-template-columns: minmax(0, 1fr);
}

.summary-pairs li.layout-stack .summary-value {
  grid-column: 1;
  justify-self: start;
}

#summaryPanel .summary-pairs li,
.summary-panel .summary-pairs li,
#yrkePanel .summary-pairs li {
  background: rgba(31, 34, 40, .78);
  border: 1px solid rgba(255, 255, 255, .06);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02);
}

#summaryPanel .summary-pairs li::before,
.summary-panel .summary-pairs li::before,
#yrkePanel .summary-pairs li::before {
  content: '';
  position: absolute;
  top: .55rem;
  bottom: .55rem;
  left: .6rem;
  width: .22rem;
  border-radius: 1rem;
  background: linear-gradient(90deg, rgba(227, 186, 106, .92), rgba(227, 186, 106, .55));
  opacity: .95;
}

.summary-key {
  grid-column: 1;
  min-width: 0;
  color: var(--subtxt);
  text-transform: uppercase;
  letter-spacing: .03em;
  font-size: .75rem;
  line-height: 1.2;
}

.summary-pairs .summary-key::after {
  content: '';
  margin: 0;
}

.summary-pairs .summary-key:empty::after {
  content: '';
}

.summary-value {
  grid-column: 2;
  min-width: 0;
  color: var(--txt);
  word-break: break-word;
  font-weight: 600;
  font-size: 1.05rem;
  text-align: left;
  justify-self: start;
}

#yrkePanel .info-panel-meta .summary-pairs,
#infoPanel .info-panel-meta .summary-pairs {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: .35rem;
  padding: 0;
}

#yrkePanel .info-panel-meta .summary-pairs li,
#infoPanel .info-panel-meta .summary-pairs li {
  position: relative;
  display: inline-flex;
  align-items: baseline;
  gap: .4rem;
  padding: .3rem .6rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, .12);
  background: rgba(255, 255, 255, .06);
  box-shadow: none;
  min-width: 0;
}

#yrkePanel .info-panel-meta .summary-pairs li::before,
#infoPanel .info-panel-meta .summary-pairs li::before {
  content: none;
}

#yrkePanel .info-panel-meta .summary-pairs .summary-key,
#infoPanel .info-panel-meta .summary-pairs .summary-key {
  display: inline;
  grid-column: auto;
  min-width: 0;
  color: var(--subtxt);
  text-transform: uppercase;
  letter-spacing: .03em;
  font-size: .72rem;
  line-height: 1.15;
}

#yrkePanel .info-panel-meta .summary-pairs .summary-value,
#infoPanel .info-panel-meta .summary-pairs .summary-value {
  display: inline;
  grid-column: auto;
  min-width: 0;
  color: var(--txt);
  font-weight: 600;
  font-size: .95rem;
  line-height: 1.2;
}

#yrkePanel .info-panel-meta .summary-pairs .summary-value.align-right,
#infoPanel .info-panel-meta .summary-pairs .summary-value.align-right {
  margin-left: auto;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yrkePanel .info-panel-meta .summary-pairs .summary-value.neg,
#infoPanel .info-panel-meta .summary-pairs .summary-value.neg {
  color: var(--danger);
}

.summary-value.align-right {
  text-align: right;
  justify-self: end;
  font-variant-numeric: tabular-nums;
}

.summary-value.neg {
  color: var(--danger);
}

.summary-values {
  grid-column: 1 / -1;
  display: flex;
  flex-wrap: wrap;
  gap: .35rem;
  align-items: flex-start;
  color: var(--txt);
  word-break: break-word;
}

@media (max-width: 420px) {
  .summary-pairs li {
    grid-template-columns: minmax(0, fit-content(16ch)) minmax(0, 1fr);
    column-gap: 1rem;
    padding: .6rem .7rem .6rem 1.15rem;
  }
  .summary-value {
    font-size: 1rem;
  }
}

.summary-chip {
  display: inline-flex;
  align-items: center;
  padding: .25rem .55rem;
  border-radius: .6rem;
  background: rgba(255, 255, 255, .08);
  border: 1px solid rgba(255, 255, 255, .1);
  font-size: .85rem;
  line-height: 1.2;
}

.summary-chip-btn {
  cursor: pointer;
  transition: background .15s ease, box-shadow .15s ease, transform .1s ease;
  color: inherit;
}

.summary-chip-btn:hover {
  background: rgba(255, 255, 255, .14);
}

.summary-chip-btn:focus-visible {
  outline: 2px solid rgba(255, 255, 255, .35);
  outline-offset: 2px;
  box-shadow: 0 0 0 2px rgba(0, 0, 0, .35);
}

.summary-chip-btn:active {
  transform: scale(.97);
}

.summary-chip-more {
  color: var(--subtxt);
  border-style: dashed;
}

.summary-titles .summary-key {
  width: 100%;
  flex: 0 0 auto;
}

.summary-titles .summary-title-item {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: .55rem;
  padding: .85rem .95rem .9rem 1.35rem;
  border-radius: .85rem;
  border: 1px solid rgba(255, 255, 255, .05);
  background: rgba(31, 34, 40, .75);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02);
}



.summary-sublist {
  display: flex;
  flex-direction: column;
  gap: .4rem;
  width: 100%;
}

.summary-chip-title {
  justify-content: flex-start;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: .04em;
  font-size: .75rem;
  color: var(--accent);
}

.summary-sublist ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: .3rem;
}

.summary-subitem {
  font-size: .95rem;
  color: var(--txt);
  line-height: 1.35;
}

.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: .6rem;
}

.summary-grid.tight {
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: .25rem;
}

.summary-grid li {
  display: flex;
  flex-direction: column;
  gap: .25rem;
  padding: .6rem .7rem;
  border-radius: .6rem;
  border: 1px solid var(--card-border);
  background: rgba(255, 255, 255, .02);
}

.summary-grid.tight li {
  padding: .28rem .32rem;
  gap: .12rem;
  align-items: center;
}

.summary-grid .summary-key,
.summary-grid .summary-value,
.summary-grid .summary-values {
  flex: none;
  min-width: 0;
}

.summary-grid .summary-key {
  font-size: .75rem;
  text-transform: uppercase;
  letter-spacing: .03em;
  color: var(--subtxt);
}

.summary-grid .summary-value {
  font-size: 1.2rem;
  line-height: 1.1;
}

.summary-grid.tight .summary-key {
  text-align: center;
  width: 100%;
  font-size: .7rem;
  letter-spacing: .02em;
}

.summary-grid.tight .summary-value {
  text-align: center;
  width: 100%;
  font-size: 1rem;
  line-height: 1.05;
}

.summary-text li {
  position: relative;
  color: var(--txt);
  font-size: .95rem;
  padding: .75rem .95rem .75rem 1.35rem;
  border-radius: .8rem;
  border: 1px solid rgba(255, 255, 255, .05);
  background: rgba(31, 34, 40, .72);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02);
  font-variant-numeric: tabular-nums;
  line-height: 1.35;
}

#summaryPanel .summary-text li,
.summary-panel .summary-text li,
#yrkePanel .summary-text li {
  padding: .6rem .95rem .6rem 1.35rem;
}

.summary-text li + li {
  border-top: 1px solid rgba(255, 255, 255, .05);
  padding-top: .35rem;
}

#summaryPanel .summary-text li + li,
.summary-panel .summary-text li + li {
  border-top: none;
  margin-top: .35rem;
  padding-top: .6rem;
}

#yrkePanel .info-panel-content {
  display: flex;
  flex-direction: column;
  gap: 1.2rem;
}

#yrkePanel .info-panel-tagswrap,
#infoPanel .info-panel-tagswrap {
  display: flex;
  flex-wrap: wrap;
  gap: .25rem;
}

#yrkePanel .info-panel-tags .tags,
#infoPanel .info-panel-tags .tags {
  display: flex;
  flex-wrap: wrap;
  gap: .25rem;
}

#yrkePanel .info-panel-tags .tag,
#infoPanel .info-panel-tags .tag {
  border-radius: 999px;
  padding: .2rem .6rem;
  font-size: .8rem;
  line-height: 1.1;
}

#yrkePanel .info-panel-body,
#yrkePanel .info-panel-extra {
  display: flex;
  flex-direction: column;
  gap: .55rem;
}

#yrkePanel .info-panel-body > .info-block,
#yrkePanel .info-panel-extra > .info-block {
  margin: 0;
  position: relative;
  padding: .75rem .95rem .75rem 1.35rem;
  border-radius: .85rem;
  border: 1px solid rgba(255, 255, 255, .05);
  background: rgba(31, 34, 40, .72);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02);
}

#yrkePanel .info-block p {
  margin: 0;
}

#yrkePanel .info-block p + p {
  margin-top: .6rem;
}

#yrkePanel .info-panel-body .levels {
  margin: .4rem 0 0;
  gap: .5rem;
}

#yrkePanel .info-panel-body p,
#yrkePanel .info-panel-extra p {
  margin: 0;
}

@media (max-width: 420px) {
  .summary-titles .summary-title-item {
    padding: .75rem .8rem .8rem 1.2rem;
  }
  .summary-subitem {
    font-size: .92rem;
  }
  .summary-text li {
    padding: .65rem .8rem .65rem 1.25rem;
  }
}

#effectsPanel .effect-entry,
.effects-panel .effect-entry {
  display: flex;
  flex-direction: column;
  gap: .35rem;
  padding: .45rem .25rem .45rem .85rem;
  border-left: .22rem solid rgba(227, 186, 106, .45);
}

#effectsPanel .effect-label,
.effects-panel .effect-label {
  font-size: 1rem;
  letter-spacing: .03em;
  text-transform: uppercase;
  color: var(--txt);
}

#effectsPanel .effect-lines,
.effects-panel .effect-lines {
  display: flex;
  flex-direction: column;
  gap: .25rem;
  margin-left: .25rem;
}

#effectsPanel .effect-line,
.effects-panel .effect-line {
  color: var(--subtxt);
  font-size: .95rem;
  line-height: 1.35;
}

#effectsPanel .effect-source,
.effects-panel .effect-source {
  color: var(--accent);
  font-weight: 600;
}

/* Rad för knappar i filterpanelen */
.char-btn-row {
  display: grid;
  /* Responsiv standardlayout: flera knappar per rad när utrymme finns */
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: .6rem;
  margin-bottom: .8rem;
  align-items: stretch;
}
/* Fasta kolumnuppdelningar för konsekvent layout i Formaliteter */
.char-btn-row.two-col   { grid-template-columns: repeat(2, 1fr); }
.char-btn-row.three-col { grid-template-columns: repeat(3, 1fr); }
/* Fem kolumner på breda skärmar men bryt till flera rader på mobiler */
.char-btn-row.five-col  { grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); }
.char-btn-row.three-col + .char-btn-row.three-col { margin-top: 0; }
.char-btn-row .char-btn { width: 100%; height: 100%; }

/* Säkerställ att knapparna i Formaliteter alltid linjerar och inte överflödar */
#filterFormalCard .card-desc { overflow-x: hidden; }
#filterFormalCard .char-btn-row { justify-items: stretch; align-items: stretch; }
#filterFormalCard .char-btn-row .char-btn {
  min-width: 0;          /* tillåt krympning i gridcellen */
  max-width: 100%;
  overflow-wrap: anywhere; /* bryt långa ord/frases vid behov */
  word-break: break-word;
}

/* Grupp för partytillhörighet */
.party-toggles {
  padding: 0;
  margin-top: .6rem;
}
.toggle-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
.toggle-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.toggle-desc {
  flex: 1;
  margin-right: .5rem;
  font-size: .95rem;
}

.toggle-question,
.toggle-note {
  display: block;
}

.toggle-question {
  font-weight: 600;
}

/* Hjälp-rutan: större rubrik och mellanrum mot Sökfilter */
.help-card { margin-top: 1rem; }
.help-card .toggle-question { font-size: 1.2rem; }
.party-toggle {
  padding: .45rem .6rem;
  border-radius: .6rem;
  border: none;
  background: var(--accent);
  color: #fff;
  font-size: 1.2rem;
  cursor: pointer;
  transition: transform .1s ease, opacity .1s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.party-toggle:hover  { opacity: .85; }
.party-toggle:active { transform: scale(.95); opacity: .7; }
.party-toggle.active {
  background: var(--danger);
}

/* ---------- Panel (vit/mörk låda) ---------- */
.panel {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  padding: 2rem 1.6rem;
  width: 100%;
  max-width: 520px;
  box-shadow: var(--shadow);
}

.inventory-panel .inventory-content {
  display: flex;
  flex-direction: column;
  gap: 1.4rem;
}

.inventory-panel .inventory-content .card-list {
  margin-top: 0;
}

.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: .8rem;
  flex-wrap: wrap;
  row-gap: .6rem;
}

.header-actions {
  display: flex;
  gap: .6rem;
}

.panel-header .app-title {
  flex: 1;
  margin: 0;
}

/* ---------- Input/Select ---------- */
input, select, textarea {
  width: 100%;
  padding: .65rem 1rem;
  border-radius: .6rem;
  border: 1.5px solid var(--border);
  background: var(--bg);
  color: var(--txt);
  font-size: 1rem;
}
select option {
  color: var(--bg);
  background: #f4f4f4;
}
input[type=number] {
  -moz-appearance: textfield;
}
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent);
}

/* ---------- Kortlista & kort ---------- */
.card-list {
  list-style: none;
  padding: 0;
  margin-top: 1.4rem;
  display: flex;
  flex-direction: column;
  gap: .85rem;
}

.cat-group > details > summary {
  font-size: 1.3rem;
  font-weight: 600;
  cursor: pointer;
}

.cat-group .card-list {
  margin-top: .6rem;
}
.card {
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: 1rem;
  padding: .85rem 1.05rem;
  display: flex;
  flex-direction: column;
  gap: .35rem;
  position: relative;
  transition: outline .1s ease, outline-offset .1s ease, box-shadow .1s ease;
}

.entry-card-summary {
  display: flex;
  flex-direction: column;
  gap: .45rem;
}

.entry-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: .45rem;
}

.entry-row-header {
  display: grid;
  grid-template-columns: minmax(0, 1fr) auto auto;
  align-items: center;
  gap: .45rem;
}

.entry-collapse-btn {
  border: none;
  background: none;
  background-color: transparent;
  color: inherit;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  cursor: pointer;
  transition: color .15s ease, transform .15s ease;
}

.entry-collapse-btn::before {
  content: '▼';
  font-family: inherit;
  line-height: 1;
  transition: transform .15s ease;
}

.entry-card.compact .entry-collapse-btn::before {
  content: '▶';
}

.entry-collapse-btn:hover {
  color: var(--subtxt);
}

.entry-collapse-btn:active {
  transform: scale(.94);
}

.entry-collapse-btn:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  border-radius: 4px;
}

.entry-header-main {
  display: flex;
  align-items: center;
  gap: .45rem;
  min-width: 0;
}

.entry-header-main .card-title {
  flex: 1 1 auto;
  min-width: 0;
}

.entry-header-xp,
.entry-header-actions {
  display: flex;
  align-items: center;
  gap: .35rem;
  justify-content: flex-end;
}

/* nivåväljare i åtgärdsraden */
.entry-level-control {
  flex: 1 1 12rem;
  min-width: 8.5rem;
  margin-right: auto;
  display: flex;
}

.entry-level-control select.level {
  appearance: none;
  -webkit-appearance: none;
  width: 100%;
  min-width: 0;
  height: var(--ctrl-btn-size);
  border-radius: .6rem;
  border: 1.5px solid var(--border);
  background: rgba(255, 255, 255, .04);
  color: var(--txt);
  padding: 0 .6rem;
  text-transform: none;
  font-weight: 600;
  letter-spacing: .03em;
  cursor: pointer;
}

.entry-level-control select.level option {
  color: var(--bg);
}

.entry-level-control select.level:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

.entry-header-xp {
  font-weight: 600;
  letter-spacing: .03em;
  white-space: nowrap;
}

.entry-header-xp .entry-xp-value {
  font-variant-numeric: tabular-nums;
}

.entry-header-actions .char-btn.info-btn {
  width: 32px;
  min-width: 32px;
  height: 32px;
  padding: 0;
  border-radius: 999px;
  background: none;
  border: 1.5px solid transparent;
  color: var(--txt);
  font-size: 1.05rem;
}

.entry-header-actions .char-btn.info-btn:hover {
  color: var(--subtxt);
}

.entry-header-actions .char-btn.info-btn:active {
  transform: none;
}

.entry-header-actions .char-btn.info-btn:focus-visible {
  outline: 2px solid var(--txt);
  outline-offset: 2px;
}

.entry-row-info {
  padding: 0;
}

.entry-info-panel {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: flex-start;
  gap: .25rem .55rem;
  width: 100%;
  font-size: clamp(.7rem, .66rem + .25vw, .9rem);
  line-height: 1.2;
}

.entry-info-block {
  display: inline-flex;
  flex-wrap: wrap;
  align-items: center;
  gap: .3rem;
  min-width: 0;
}

.entry-info-block.entry-info-tags {
  gap: .25rem .4rem;
}

.entry-info-block.entry-info-box {
  flex: 1 1 auto;
  justify-content: flex-start;
  min-width: 0;
}

.entry-row-actions {
  gap: .35rem;
  justify-content: flex-end;
  align-items: center;
}

.entry-row-actions .entry-action-qualities {
  flex: 1 1 auto;
  min-width: 0;
  margin-right: auto;
  display: flex;
  align-items: center;
}

.entry-row-actions .entry-action-controls {
  display: flex;
  flex: 1 1 15rem;
  min-width: 0;
  flex-wrap: wrap;
  align-items: center;
  justify-content: flex-end;
  gap: .35rem;
}

.entry-row-actions .entry-action-qualities .tags {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  gap: .25rem;
  font-size: clamp(.55rem, .52rem + .18vw, .72rem);
  line-height: 1.1;
  white-space: nowrap;
  overflow-x: auto;
  scrollbar-width: none;
}

.entry-row-actions .entry-action-qualities .tags::-webkit-scrollbar {
  display: none;
}

.entry-row-actions .entry-action-qualities .tag {
  font-size: inherit;
  padding: .08rem .35rem;
  white-space: nowrap;
}

.entry-row-actions .entry-action-group {
  flex-shrink: 0;
}

.entry-row-actions .entry-action-group-dynamic,
.entry-row-actions .entry-action-group-standard {
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-end;
  gap: .35rem;
}

.entry-row-actions .entry-action-group-standard {
  margin-left: 0;
}

.entry-row-actions.only-standard .entry-action-group-standard {
  margin-left: 0;
}

.entry-card-details {
  margin-top: .5rem;
  display: flex;
  flex-direction: column;
  gap: .55rem;
}

.card.vehicle-over {
  background: var(--danger-bg);
}

/* särställ "Formaliteter"-kort (inkl. uppdelade) */
.card[data-special="__formal__"],
.card[data-special="__tools__"],
.card[data-special="__invfunc__"],
.card[data-special="__info__"] {
  border: 2px solid var(--toolborder);
}
.card-title {
  display: flex;
  align-items: center;
  gap: .45rem;
  font-size: calc(1.34rem - 2px);
  font-weight: 600;
}
#invList .card-title {
  cursor: pointer;
}
#invFormal .card-title {
  cursor: pointer;
}
.collapse-btn {
  width: 1.25rem;
  height: 1.25rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  vertical-align: middle;
  user-select: none;
}
.card-title > span > .collapse-btn {
  margin-right: .4rem;
}
.card-title .collapse-btn::before {
  content: '▼';
  line-height: 1;
}
.card.compact .card-title .collapse-btn::before {
  content: '▶';
}
#filterPanel .card.compact .card-desc {
  display: none;
}
.xp-cost,
.entry-header-xp .entry-xp-value {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: .22rem .72rem;
  background: var(--xp-pill-bg);
  color: var(--xp-pill-text);
  font-size: .9rem;
  font-weight: 600;
  line-height: 1.1;
  border-radius: 999px;
  border: 1px solid var(--xp-pill-border);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .04), 0 1px 2px rgba(0, 0, 0, .4);
  text-shadow: 0 1px 1px rgba(0, 0, 0, .35);
  letter-spacing: .01em;
  white-space: nowrap;
  flex: 0 0 auto;
}
.card-info-box {
  display: flex;
  flex-wrap: wrap;
  gap: .35rem .6rem;
  width: 100%;
  background: rgba(255, 255, 255, .035);
  border: 1px solid rgba(255, 255, 255, .06);
  border-radius: .7rem;
  padding: .45rem .65rem;
  margin: .35rem 0 .25rem;
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, .24);
  align-items: center;
}

.card-info-tags {
  display: flex;
  flex-wrap: wrap;
  gap: .35rem;
  flex: 1 1 280px;
  min-width: 0;
  align-items: center;
}

.card-info-facts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: .3rem .6rem;
  align-items: center;
  justify-content: flex-start;
  flex: 1 1 180px;
}

.card-info-fact.card-info-price {
  justify-self: end;
}

.card-info-inline {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: flex-start;
  gap: .3rem .5rem;
  width: 100%;
}

.card-info-inline .card-info-tags {
  flex: 1 1 auto;
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-start;
  gap: .25rem .35rem;
}

.card-info-inline .card-info-facts {
  flex: 1 1 auto;
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-start;
  gap: .25rem .55rem;
}

.card-info-inline .card-info-fact.card-info-price {
  margin-left: auto;
}

.card-info-fact {
  display: inline-flex;
  align-items: center;
  gap: .35rem;
  font-size: 1em;
  line-height: 1.2;
  flex-wrap: wrap;
}

.card-info-fact.level-marker {
  align-items: center;
}

.card-info-fact.level-marker .card-info-fact-value {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 1.8rem;
  height: 1.8rem;
  padding: 0 .5rem;
  background: rgba(255, 255, 255, .08);
  border-radius: .5rem;
  font-weight: 700;
  letter-spacing: .04em;
  text-transform: uppercase;
}

.card-info-fact-label {
  color: var(--subtxt);
  font-weight: 600;
  font-size: .75rem;
  letter-spacing: .01em;
  white-space: nowrap;
}

.card-info-fact-value {
  color: var(--txt);
  font-weight: 600;
  white-space: normal;
}

.tag.xp-cost {
  font-size: .85rem;
  padding: .2rem .65rem;
}
.conflict-btn {
  font-size: 1.1rem;
}
.card-desc  { font-size: 1.15rem; }
.entry-card:not(.compact) .card-desc > .info-tags {
  display: none;
}
.entry-card.compact:not(.empty) {
  min-height: 0;
}
.card.compact .entry-card-details { display: none; }

/* Meta badges (P, V, level) */
.meta-badges {
  display: inline-flex;
  gap: .25rem;
  align-items: center;
  flex: 0 0 auto;
  min-width: 0;
  align-self: flex-end;
}
.meta-badge {
  background: var(--border);
  color: var(--txt);
  padding: .2rem .4rem;
  border-radius: .45rem;
  font-size: .78rem;
  line-height: 1.2;
  white-space: nowrap;
}
.meta-badge.level-badge { color: var(--accent); background: rgba(61,124,255,.15); }

.control-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: .35rem;
  align-items: center;
}

.control-buttons button {
  align-self: initial;
  flex: 0 0 auto;
  padding: 0;
}

.control-buttons .char-btn.add-btn {
  white-space: normal;
}

.entry-row-actions .control-buttons .char-btn {
  width: var(--ctrl-btn-size);
  min-width: var(--ctrl-btn-size);
  height: var(--ctrl-btn-size);
  padding: 0;
}

.entry-row-actions .control-buttons .char-btn[data-clear-filters] {
  width: auto;
  min-width: 0;
  height: auto;
  padding: .55rem 1.1rem;
}

@media (max-width: 680px) {
  .entry-row-actions .control-buttons .char-btn[data-clear-filters] {
    padding: .45rem .9rem;
  }
}

/* Lista med niva-beskrivningar for formagor */
.levels {
  margin-top: .6rem;
  display: flex;
  flex-direction: column;
  gap: .55rem;
}

.info-block-levels .levels {
  margin-top: 0;
}

.level-block {
  border: 1px solid rgba(255, 255, 255, .08);
  border-radius: .85rem;
  background: rgba(31, 34, 40, .72);
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .02);
  overflow: hidden;
  transition: border-color .2s ease, background .2s ease, box-shadow .2s ease;
}

.level-block summary {
  list-style: none;
  margin: 0;
  padding: .7rem 1rem .7rem 1.2rem;
  font-weight: 600;
  font-size: 1rem;
  display: flex;
  align-items: center;
  gap: .75rem;
  cursor: pointer;
  color: var(--txt);
  background: transparent;
}

.level-block summary::-webkit-details-marker {
  display: none;
}

.level-block summary::after {
  content: '';
  width: .65rem;
  height: .65rem;
  border-right: 2px solid var(--subtxt);
  border-bottom: 2px solid var(--subtxt);
  transform: rotate(-45deg);
  margin-left: auto;
  transition: transform .2s ease, border-color .2s ease;
}

.level-block[open] summary::after {
  transform: rotate(45deg);
  border-color: var(--txt);
}

.level-block summary:focus-visible {
  outline: 2px solid var(--txt);
  outline-offset: 2px;
}

.level-block .level-content {
  padding: 0 1rem 1rem 1.2rem;
  border-top: 1px solid rgba(255, 255, 255, .05);
}

.level-block .level-content > * {
  margin: 0;
}

.level-block .level-content > * + * {
  margin-top: .6rem;
}

.level-block.level-locked {
  border-color: rgba(246, 65, 65, .22);
  background: rgba(59, 28, 28, .12);
  box-shadow: inset 0 0 0 1px rgba(246, 65, 65, .08);
}

.level-block.level-locked summary {
  color: #e9d6d2;
}

.level-block.level-locked summary::after {
  border-color: rgba(249, 188, 188, .42);
}

.level-block.level-locked .level-content {
  border-top-color: rgba(246, 65, 65, .14);
}

@media (max-width: 520px) {
  .level-block summary {
    padding: .6rem .85rem;
  }

  .level-block .level-content {
    padding: 0 .85rem .85rem 1rem;
  }
}

.card button {
  align-self: flex-end;
  background: var(--accent);
  border: none;
  border-radius: .6rem;
  color: #fff;
  padding: .45rem 1.4rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform .1s ease, opacity .1s ease;
}
.card .entry-collapse-btn {
  background: none;
  color: var(--txt);
  padding: 0;
}
.card button:hover  { opacity: .85; }
.card button:active { transform: scale(.95); opacity: .7; }
.card button.danger { background: var(--danger); }


.entry-tags {
  display: flex;
  flex-flow: column wrap;
  align-content: flex-start;
  gap: .25rem .35rem;
  max-height: calc(var(--entry-tag-row, 1.35rem) * 2 + .25rem);
  min-height: 0;
}

@media (max-width: 680px) {
  .entry-row-header {
    display: grid;
    grid-template-columns: minmax(0, 1fr) auto auto;
    align-items: start;
    gap: .4rem;
  }

  .entry-row-header .entry-header-main {
    min-width: 0;
  }

  .entry-row-header .entry-header-xp {
    margin-left: 0;
    justify-self: end;
  }

  .entry-row-header .entry-header-actions {
    justify-self: end;
    align-self: start;
  }

  .entry-tags {
    flex-flow: row wrap;
    max-height: none;
  }

  .entry-tags {
    width: 100%;
  }
}
.entry-tags-mobile {
  display: none;
}
.entry-tags .tag,
.card .tags .tag {
  font-size: .78rem;
  padding: .12rem .5rem;
  border-radius: .5rem;
  line-height: 1.25;
}
.entry-tags .tag {
  white-space: nowrap;
}
.card .tags {
  gap: .35rem;
}

.count-badge {
  margin-left: .3rem;
  background: var(--border);
  color: var(--txt);
  padding: 0 .4rem;
  border-radius: .5rem;
  font-size: .85rem;
}

/* ---------- Fast verktygsrad ---------- */
.toolbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  width: 100%;
  z-index: 900;
  background: var(--panel);
  border-top: 1.5px solid var(--border);
  padding: .6rem .8rem;
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
.toolbar-top {
  display: flex;
  align-items: center;
  gap: .6rem;
}
.toolbar-top input {
  flex: 1 1 110px;
  min-width: 90px;
}
.button-row {
  display: flex;
  gap: .3rem;
}
.button-row > a,
.button-row > button {
  flex: 1;
  min-width: 0;
}

/* animation when inventory items change */
.inv-flash { animation: invFlash .6s ease-out; }
.rm-flash { animation: rmFlash .6s ease-out; }
@keyframes invFlash {
  0% { background: rgba(61, 124, 255, 0.1); }
  100% { background: var(--card); }
}
@keyframes rmFlash {
  0% { background: rgba(255, 61, 61, 0.1); }
  100% { background: var(--card); }
}

/* XP-räknare i verktygsrad */
.toolbar .exp-counter {
  display: flex;
  align-items: center;
  gap: .3rem;
  background: var(--border);
  color: var(--txt);
  padding: .3rem .7rem;
  border-radius: .55rem;
  font-weight: 600;
  font-size: .9rem;
  white-space: nowrap;
}
.toolbar .exp-counter span {
  color: var(--accent);
  font-variant-numeric: tabular-nums;
}

.exp-counter { font-weight: 500; }

/* Rödmarkering för negativa värden */
.exp-counter.under { color: #ff4040; }
.exp-counter.under span { color: inherit; }


/* Specifika paneler använder samma klass plus egna id:n */
#filterPanel { max-width: 360px; }
#summaryPanel{ max-width: 360px; }
#effectsPanel{ max-width: 360px; }

.inv-header { display: flex; justify-content: space-between; align-items: center; }
.inv-actions { display: flex; align-items: baseline; gap: .4rem; }
/* Lite extra luft under rubriken i Egenskaper-vyn */
.traits-panel .panel-header,
.summary-panel .panel-header,
.effects-panel .panel-header { margin-bottom: 1rem; }
/* Lite större mellanrum mellan knapparna i Egenskaper- och översiktssidorna */
.traits-panel .header-actions,
.summary-panel .header-actions,
.effects-panel .header-actions { gap: .6rem; }

.traits-tabs {
  display: flex;
  gap: .6rem;
  margin: 0 auto 1.5rem;
  padding: 0;
  max-width: 520px;
}

.traits-tab {
  flex: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: .7rem 1rem;
  border-radius: .75rem;
  background: rgba(255,255,255,.05);
  color: var(--txt);
  text-decoration: none;
  font-weight: 600;
  transition: background .15s ease, color .15s ease, transform .1s ease;
  border: 1.5px solid rgba(255,255,255,.08);
}

.traits-tab:hover { opacity: .85; }
.traits-tab:active { transform: scale(.97); }
.traits-tab[aria-current="page"],
.traits-tab.active {
  background: var(--accent);
  color: #fff;
  border-color: transparent;
}

.summary-panel,
.effects-panel {
  margin-top: 0;
}

/* Knappar i inventariepanelen */
.inv-buttons {
  display: flex;
  flex-direction: column;
  gap: .8rem;
  margin-bottom: 1rem;
}
.inv-buttons .char-btn { width: 100%; }

/* ---------- Pengahantering ---------- */
.money-form {
  display: flex;
  flex-direction: column;
  gap: .6rem;
  margin-top: 1rem;
}
.money-form .money-row {
  display: flex;
  gap: .4rem;
}
.money-form input {
  flex: 1;
  min-width: 6rem;
}

/* ---------- Select nivå ---------- */
select.level {
  align-self: flex-start;
  margin-top: .2rem;
  padding: .55rem 1rem;
  border-radius: .6rem;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--txt);
  font-size: 1rem;
}

/* ---------- Karaktärsdrag ---------- */
.traits-content .summary-section {
  gap: .85rem;
}

.trait-xp-summary {
  display: flex;
  flex-direction: column;
  gap: .8rem;
  background: rgba(255, 255, 255, .03);
  border: 1px solid var(--border);
  border-radius: .85rem;
  padding: .9rem 1.05rem 1rem;
  transition: border-color .2s ease, box-shadow .2s ease;
}

.trait-xp-summary.under {
  border-color: var(--danger);
  box-shadow: 0 0 0 1px rgba(255, 64, 64, .35);
}

.trait-xp-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: .75rem;
  flex-wrap: wrap;
}

.trait-xp-title {
  font-size: .84rem;
  letter-spacing: .06em;
  text-transform: uppercase;
  color: var(--accent);
  font-weight: 600;
}

.trait-xp-buttons {
  margin: 0;
  gap: .45rem;
  justify-content: flex-end;
  flex-wrap: wrap;
}

.trait-xp-buttons .char-btn.icon {
  width: 2.45rem;
  height: 2.45rem;
  padding: 0;
}

.trait-xp-buttons .char-btn.icon .btn-icon {
  width: 1.65rem;
  height: 1.65rem;
}

.trait-xp-buttons input {
  width: 5.5rem;
  font-size: 1.05rem;
  font-weight: 600;
}

.trait-xp-row {
  display: flex;
  align-items: baseline;
  justify-content: center;
  gap: 1.4rem;
  flex-wrap: wrap;
}

.trait-xp-item {
  display: inline-flex;
  align-items: baseline;
  gap: .35rem;
  white-space: nowrap;
}

.trait-xp-label {
  font-size: .75rem;
  letter-spacing: .08em;
  text-transform: uppercase;
  color: var(--subtxt);
}

.trait-xp-value {
  font-size: 1.26rem;
  font-weight: 650;
  font-variant-numeric: tabular-nums;
}

.trait-meta {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: .6rem;
}

.traits-total-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: .55rem;
  margin: 0 auto;
}

.traits-total-row .traits-total {
  margin: 0;
}

.traits-reset-btn {
  width: 2.4rem;
  height: 2.4rem;
  padding: .45rem;
  border-radius: .55rem;
  flex-shrink: 0;
}

.traits-total {
  margin: 0 auto;
  font-weight: 600;
  background: rgba(255, 255, 255, .03);
  border: 1px solid var(--border);
  border-radius: .75rem;
  padding: .55rem .95rem;
  text-align: center;
  transition: border-color .2s ease, color .2s ease;
}

.traits-total.good  { border-color: rgba(143, 218, 140, .45); color: #8fda8c; }
.traits-total.under { border-color: rgba(255, 176, 176, .45); color: #ffb0b0; }
.traits-total.over  { border-color: rgba(255, 64, 64, .55); color: #ff4040; }

.trait-extra-meta {
  font-size: .82rem;
  color: var(--subtxt);
  min-height: 1.2rem;
  text-align: center;
}

.traits-grid {
  display: grid;
  gap: .75rem;
  margin: 0;
}


.trait {
  background: rgba(255, 255, 255, .02);
  border: 1px solid var(--border);
  border-radius: .95rem;
  padding: .8rem .9rem;
  display: flex;
  flex-direction: column;
  gap: .6rem;
  text-align: left;
  transition: border-color .2s ease, box-shadow .2s ease;
}

.trait:hover {
  border-color: rgba(255, 255, 255, .2);
  box-shadow: 0 10px 30px rgba(0, 0, 0, .15);
}

.trait-header {
  display: flex;
  justify-content: center;
  margin-bottom: .5rem;
}

.trait-label {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  font-weight: 650;
  letter-spacing: .04em;
  background: rgba(255, 255, 255, .04);
  border: 1px solid var(--border);
  border-radius: .75rem;
  padding: .45rem 1.1rem;
  text-align: center;
  margin: 0 auto;
}

.trait-controls {
  display: flex;
  justify-content: center;
  gap: .45rem;
  flex-wrap: nowrap;
}

.trait-count-row {
  display: flex;
  justify-content: center;
  margin-top: .25rem;
}

.trait-btn {
  background: rgba(255, 255, 255, .08);
  border: 1px solid transparent;
  border-radius: .6rem;
  padding: .3rem .6rem;
  font-size: .85rem;
  cursor: pointer;
  line-height: 1;
  text-align: center;
  color: var(--txt);
  transition: background .15s ease, transform .1s ease, border-color .15s ease;
  min-width: 3.1rem;
}

.trait-btn:hover  { background: rgba(255, 255, 255, .16); }
.trait-btn:active { transform: scale(.95); opacity: .8; }
.trait-btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }


.trait-extra {
  font-size: .82rem;
  color: var(--subtxt);
  line-height: 1.45;
  position: relative;
  padding-left: 1.05rem;
}

.trait-extra::before {
  content: '•';
  position: absolute;
  left: 0;
  color: var(--accent);
  opacity: .7;
}


.trait-count {
  font-size: .78rem;
  color: var(--txt);
  background: rgba(255, 255, 255, .08);
  border: 1px solid rgba(255, 255, 255, .12);
  border-radius: .65rem;
  padding: .2rem .6rem;
  cursor: pointer;
  align-self: center;
  transition: background .15s ease, border-color .15s ease, transform .1s ease;
}

.trait-count:hover  { background: rgba(255, 255, 255, .16); border-color: rgba(255, 255, 255, .2); }
.trait-count:active { transform: translateY(1px); }
.trait-count:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

@media (min-width: 520px) {
  .trait-meta {
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 1.2rem;
  }
}

@media (min-width: 560px) {
  .traits-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  }
}

@media (min-width: 640px) {
  .trait-xp-row {
    gap: 2rem;
  }
}

/* ---------- Småskärmar ---------- */
@media (max-width: 420px) {
  .app-title { font-size: 2rem; }
  .panel     { padding: 1.6rem 1.2rem; }
  .toolbar   { padding: .5rem .6rem; gap: .5rem; }
  .toolbar select, .toolbar input { min-width: 80px; }

  .trait-xp-buttons {
    gap: .35rem;
  }
  .trait-xp-row {
    gap: 1rem;
  }
  .trait-xp-buttons .char-btn.icon {
    width: 2.2rem;
    height: 2.2rem;
    padding: 0;
  }
  .trait-xp-buttons .char-btn.icon .btn-icon {
    width: 1.45rem;
    height: 1.45rem;
  }
  .trait-xp-buttons input {
    width: 5rem;
    font-size: 1rem;
  }
  .traits-grid  { gap: .7rem; }
  .trait        { padding: .75rem .85rem; }
  .trait-btn    { padding: .22rem .55rem; font-size: .82rem; min-width: 2.75rem; }
  .control-buttons { gap: .3rem; }
  .control-buttons .char-btn {
    font-size: .95rem;
  }
  .entry-tags-block {
    display: flex;
  }
  .entry-tags-mobile {
    display: none;
  }
  .entry-tags-mobile .tag {
    white-space: nowrap;
  }
  .entry-tags {
    --entry-tag-row: 1.25rem;
    gap: .2rem .28rem;
    max-height: none;
  }
  .xp-cost,
  .entry-header-xp .entry-xp-value {
    font-size: .78rem;
    padding: .18rem .6rem;
  }
  .tag.xp-cost {
    font-size: .72rem;
    padding: .16rem .5rem;
  }
  .inv-buttons { gap: .6rem; }
  .header-actions {
    gap: .4rem;
  }
  .header-actions .char-btn.icon {
    padding: .35rem .6rem;
    font-size: .9rem;
  }
}
/* ---------- Off-canvas-paneler från höger ---------- */
#filterPanel,
#yrkePanel,
#infoPanel,
#summaryPanel,
#effectsPanel,
#conflictPanel {
  position: fixed;
  top: 0;
  right: -100%;
  width: 80%;
  /* max-width för olika paneler sätts individuellt nedan */
  max-width: none; /* vi sätter nedan individuellt */
  height: 100%;
  background: var(--panel);
  box-shadow: none;
  transition: right .25s ease;
  z-index: 1000;
  overflow-y: auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  padding: 1.2rem 1rem 2rem;
  font-size: 1rem;
}

/* Specifika max-breddar */
#filterPanel { max-width: 360px; }
#summaryPanel{ max-width: 360px; }
#effectsPanel{ max-width: 360px; }
#conflictPanel { max-width: 360px; }
#yrkePanel   { max-width: 360px; font-size: 1.2rem; line-height: 1.6; }
#infoPanel   { max-width: 360px; font-size: 1rem; line-height: 1.5; }
#yrkePanel p { margin: 0 0 1rem; }
#yrkePanel table {
  width: 100%;
  border-collapse: collapse;
  margin: .5rem 0 1rem;
}
#yrkePanel th,
#yrkePanel td {
  border: 1px solid var(--card-border);
  padding: .3rem .6rem;
  text-align: left;
}
#yrkePanel th {
  background: var(--card);
}
#infoPanel p { margin: 0; }

/* När klassen .open läggs på – låt panelen glida in */
#filterPanel.open,
#yrkePanel.open,
#infoPanel.open,
#summaryPanel.open,
#effectsPanel.open,
#conflictPanel.open {
  right: 0;
  box-shadow: -4px 0 20px #0009;
}

@media (min-width: 1024px) {
  #filterPanel { max-width: 460px; }
  #summaryPanel{ max-width: 460px; }
  #effectsPanel{ max-width: 460px; }
  #conflictPanel{ max-width: 460px; }
  #yrkePanel   { max-width: 520px; }
  #infoPanel   { max-width: 520px; }
}
/* Mobile: make right panels fill ~90% width and full dynamic height */
@media (max-width: 640px) {
  #filterPanel,
  #yrkePanel,
  #infoPanel,
  #summaryPanel,
  #effectsPanel,
  #conflictPanel {
    width: 100vw;          /* cover ~100% of the screen width */
    max-width: 100vw;      /* lift 360px caps on mobile */
    height: 100dvh;       /* use dynamic viewport height (accounts for bars) */
    padding: 1.2rem 1rem 2rem;  /* keep your spacing */
    overscroll-behavior: contain;
  }
}

/* ---------- Popup för kvaliteter ---------- */
#qualPopup {
  position: fixed;
  inset: 0;                    /* top/right/bottom/left:0 */
  width: 100%;
  height: 100%;
  display: none;               /* ← döljs tills .open */
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);  /* lite mörkare för tydlighet */
  z-index: 3000;               /* över alla paneler */
}
#qualPopup.open {              /* sätts av JS */
  display: flex;
}
#qualPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#qualPopup #qualOptions {
  display: flex;
  flex-direction: column;
  gap: .5rem;
}
#qualPopup .popup-inner h3 {
  margin: 0;
}
#qualPopup .popup-inner button {
  width: 100%;
}
#qualPopup #qualOptions .char-btn.quality {
  background: var(--quality);
  border: 1.5px solid var(--quality);
}
#qualPopup #qualOptions .char-btn.neutral {
  background: var(--neutral);
  border: 1.5px solid var(--neutral);
}
#qualPopup #qualOptions .char-btn.negative {
  background: var(--negative);
  border: 1.5px solid var(--negative);
}
#qualPopup #qualOptions .char-btn.mystic {
  background: var(--mystic);
  border: 1.5px solid var(--mystic);
}
/* ---------- Popup för mästarnivå ---------- */
#masterPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#masterPopup.open {
  display: flex;
}
#masterPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
}
#masterPopup.open .popup-inner {
  transform: translateY(0);
}
#masterPopup .popup-inner h3 {
  margin-top: 0;
}
#masterPopup #masterOpts {
  display: flex;
  flex-direction: column;
  gap: .5rem;
  margin-top: .5rem;
}
#masterPopup #masterOpts label {
  display: flex;
  flex-direction: column;
  text-align: left;
  gap: .25rem;
}
#masterPopup .or-group {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: .5rem;
  padding-left: .8rem;
  margin-left: .4rem;
}
#masterPopup .or-group::before {
  content: '';
  position: absolute;
  left: -.4rem;
  top: .2rem;
  bottom: .2rem;
  width: .4rem;
  border-left: 2px solid var(--subtxt);
  border-top: 2px solid var(--subtxt);
  border-bottom: 2px solid var(--subtxt);
  border-radius: .4rem 0 0 .4rem;
}
#masterPopup .or-sep {
  text-align: center;
  color: var(--subtxt);
  font-style: italic;
  font-size: .85rem;
}
#masterPopup #masterBtns {
  display: flex;
  flex-direction: column;
  gap: .6rem;
  margin-top: .6rem;
}
#masterPopup #masterBtns button { width: 100%; }
#masterPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r Exceptionellt karakt\u00e4rsdrag ---------- */
#traitPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#traitPopup.open { display: flex; }
#traitPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#traitPopup.open .popup-inner { transform: scale(1); }
#traitPopup #traitOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#traitPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r Djurmask ---------- */
#maskPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#maskPopup.open { display: flex; }
#maskPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#maskPopup.open .popup-inner { transform: scale(1); }
#maskPopup #maskOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#maskPopup .popup-inner button { width: 100%; }
#powerPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#powerPopup.open { display: flex; }
#powerPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#powerPopup.open .popup-inner { transform: scale(1); }
#powerPopup #powerOpts { display: flex; flex-direction: column; gap: .6rem; }
#powerPopup .popup-inner button { width: 100%; }
/* ---------- Popup för hamnskifteform ---------- */
#beastPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#beastPopup.open { display: flex; }
#beastPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#beastPopup.open .popup-inner { transform: scale(1); }
#beastPopup #beastOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#beastPopup .popup-inner button { width: 100%; }


/* ---------- Popup f\u00f6r blodsband ---------- */
#bloodPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#bloodPopup.open { display: flex; }
#bloodPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#bloodPopup.open .popup-inner { transform: scale(1); }
#bloodPopup #bloodOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#bloodPopup .popup-inner button { width: 100%; }

/* ---------- Popup för Monsterlärd ---------- */
#monsterPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#monsterPopup.open { display: flex; }
#monsterPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#monsterPopup.open .popup-inner { transform: scale(1); }
#monsterPopup #monsterOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#monsterPopup .popup-inner button { width: 100%; }

/* ---------- Popup för eget föremål ---------- */
#customPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#customPopup.open { display: flex; }
#customPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  max-height: calc(100vh - 2rem);
  max-height: calc(100dvh - 2rem);
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  overflow-y: auto;
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#customPopup.open .popup-inner { transform: translateY(0); }
#customPopup .popup-inner > button { width: 100%; }
#customPopup .popup-inner input,
#customPopup .popup-inner select,
#customPopup .popup-inner textarea {
  width: 100%;
}
#customPopup .popup-inner .filter-group {
  display: flex;
  flex-direction: column;
  gap: .5rem;
  text-align: left;
}
#customPopup .popup-inner .custom-type-row,
#customPopup .popup-inner .money-row {
  display: flex;
  gap: .6rem;
  align-items: center;
  flex-wrap: wrap;
}
#customPopup .popup-inner .custom-type-row select {
  flex: 1 1 220px;
  min-width: 0;
}
#customPopup .popup-inner .money-row input {
  flex: 1;
  min-width: 0;
}
#customPopup .popup-inner .filter-group .char-btn {
  align-self: flex-start;
}
#customPopup .popup-inner .custom-type-row .char-btn {
  width: auto;
  flex: 0 0 auto;
  padding-top: .65rem;
  padding-bottom: .65rem;
  padding-left: 1rem;
  padding-right: 1rem;
  border: 1.5px solid transparent; /* match select height incl. border */
  border-radius: .6rem;             /* match control rounding */
}
#customPopup .popup-inner #customTypeTags {
  justify-content: flex-start;
}
#customPopup .popup-inner #customPowerList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
  text-align: left;
}

/* ---------- Popup för pengar ---------- */
#moneyPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#moneyPopup.open { display: flex; }
#moneyPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#moneyPopup.open .popup-inner { transform: translateY(0); }
#moneyPopup .popup-inner button { width: 100%; }

/* ---------- Popup Spara & Gratis ---------- */
#saveFreePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#saveFreePopup.open { display: flex; }
#saveFreePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#saveFreePopup.open .popup-inner { transform: scale(1); }
#saveFreePopup .popup-inner button { width: 100%; }
#saveFreePopup .confirm-row {
  display: flex;
  gap: .8rem;
}
#saveFreePopup .confirm-row button {
  flex: 1;
  width: auto;
}

/* ---------- Popup Varning Fördelspengar ---------- */
#advMoneyPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#advMoneyPopup.open { display: flex; }
#advMoneyPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#advMoneyPopup .confirm-row {
  display: flex;
  gap: .8rem;
}
#advMoneyPopup .confirm-row button {
  flex: 1;
  width: auto;
}

/* ---------- Popup för antal / köp flera ---------- */
#qtyPopup,
#buyMultiplePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#qtyPopup.open,
#buyMultiplePopup.open { display: flex; }
#qtyPopup .popup-inner,
#buyMultiplePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#qtyPopup.open .popup-inner,
#buyMultiplePopup.open .popup-inner { transform: translateY(0); }
#qtyPopup .popup-inner button,
#buyMultiplePopup .popup-inner button { width: 100%; }
#qtyItemList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}

#buyMultiplePopup .popup-item-name {
  font-weight: 600;
  margin: 0;
}

/* ---------- Popup för pris ---------- */
#pricePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#pricePopup.open { display: flex; }
#pricePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#pricePopup.open .popup-inner { transform: translateY(0); }
#pricePopup .popup-inner button { width: 100%; }
#priceItemList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
#priceItemList .price-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem;
}
#priceItemList .price-item span {
  flex: 1;
}
#priceItemList .price-item input[type="checkbox"] {
  appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid var(--card-border);
  border-radius: .25rem;
  background: var(--bg);
  cursor: pointer;
}
#priceItemList .price-item input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

/* ---------- Popup för färdmedel ---------- */
#vehiclePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#vehiclePopup.open { display: flex; }
#vehiclePopup .popup-inner,
#vehicleRemovePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#vehiclePopup.open .popup-inner,
#vehicleRemovePopup.open .popup-inner { transform: translateY(0); }
#vehiclePopup .popup-inner button,
#vehicleRemovePopup .popup-inner button { width: 100%; }
#vehicleItemList,
#vehicleRemoveItemList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
#vehicleItemList .price-item,
#vehicleRemoveItemList .price-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem;
}
#vehicleItemList .price-item span,
#vehicleRemoveItemList .price-item span {
  flex: 1;
}
#vehicleItemList .price-item input[type="checkbox"],
#vehicleRemoveItemList .price-item input[type="checkbox"] {
  appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid var(--card-border);
  border-radius: .25rem;
  background: var(--bg);
  cursor: pointer;
}
#vehicleItemList .price-item input[type="checkbox"]:checked,
#vehicleRemoveItemList .price-item input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

.vehicle-group {
  position: relative;
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem .6rem;
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
.vehicle-group .vehicle-icon {
  position: absolute;
  top: .2rem;
  right: .4rem;
}

/* ---------- Popup för borttagning av behållare ---------- */
#deleteContainerPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#deleteContainerPopup.open { display: flex; }
#deleteContainerPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#deleteContainerPopup.open .popup-inner { transform: translateY(0); }
#deleteContainerPopup .popup-inner button { width: 100%; }

/* ---------- Popup för alkemistnivå ---------- */
#alcPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#alcPopup.open { display: flex; }
#alcPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#alcPopup.open .popup-inner { transform: translateY(0); }
#alcPopup #alcOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#alcPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r smedsniv\u00e5 ---------- */
#smithPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#smithPopup.open { display: flex; }
#smithPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#smithPopup.open .popup-inner { transform: translateY(0); }
#smithPopup #smithOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#smithPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r artefaktmakarniv\u00e5 ---------- */
#artPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#artPopup.open { display: flex; }
#artPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#artPopup.open .popup-inner { transform: translateY(0); }
#artPopup #artOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#artPopup .popup-inner button { width: 100%; }

/* ---------- Popup för försvarskaraktärsdrag ---------- */
#defensePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#defensePopup.open { display: flex; }
#defensePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#defensePopup.open .popup-inner { transform: translateY(0); }
#defensePopup #defenseOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#defensePopup .popup-inner button { width: 100%; }

/* ---------- Popup för PDF-bank ---------- */
#pdfPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#pdfPopup.open { display: flex; }
#pdfPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#pdfPopup.open .popup-inner { transform: translateY(0); }
#pdfPopup #pdfOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#pdfPopup .popup-inner button { width: 100%; }

#pdfPopup .pdf-category {
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem .6rem;
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
#pdfPopup .pdf-category h3 {
  margin: 0 0 .2rem;
  font-size: 1rem;
}

/* ---------- Popup för export ---------- */
#exportPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#exportPopup.open { display: flex; }
#exportPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  max-height: 85vh;
  overflow: auto;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#exportOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#exportPopup .row-actions .char-btn { width: 100%; }
#exportPopup #exportCancel { width: 100%; }
#exportPopup .char-btn.primary { width: 100%; }
#exportPopup .char-btn:disabled { opacity: .5; cursor: not-allowed; }

/* Grouped layout for Export */
#exportPopup .export-card { padding: 1rem 1.1rem; }
#exportPopup .export-card + .export-card { margin-top: .4rem; }
#exportPopup .section-title { font-weight: 700; text-align: left; font-size: 1rem; }
#exportPopup .export-section { display: flex; flex-direction: column; gap: .6rem; }
#exportPopup .export-row { display: grid; grid-template-columns: 1fr; gap: .4rem; padding: .4rem; border: 1px solid var(--border); border-radius: .6rem; }
/* Keep title above buttons on all screen sizes */
@media (min-width: 420px) {
  #exportPopup .export-row { grid-template-columns: 1fr; }
}
#exportPopup .row-title { text-align: left; font-weight: 600; }
#exportPopup .row-actions {
  display: grid;
  /* Always show three actions (En, Flera, Zip) on one row */
  grid-template-columns: repeat(3, 1fr);
  gap: .4rem;
  align-items: stretch;
}
#exportPopup .row-actions .char-btn {
  padding: .45rem .6rem;
  font-size: .9rem;
  /* Uniform height and prevent label wrapping from stretching rows unevenly */
  min-height: 2.4rem;
  white-space: nowrap;
}

#exportPopup .export-search input { width: 100%; }
#exportPopup .export-search { margin-top: .2rem; }

#exportPopup .export-list { display: flex; flex-direction: column; gap: .4rem; }
#exportPopup .export-group { display: flex; flex-direction: column; gap: .3rem; }
#exportPopup .group-title { text-align: left; font-size: .9rem; font-weight: 600; opacity: .8; margin-top: .2rem; }
#exportPopup .group-list { display: grid; grid-template-columns: 1fr; gap: .4rem; align-items: stretch; }
@media (min-width: 420px) {
  #exportPopup .group-list { grid-template-columns: 1fr 1fr; }
}
#exportPopup .group-list .char-btn.small { padding: .45rem .7rem; font-size: .95rem; height: 100%; }
#exportPopup .char-btn.primary { background: var(--accent); }

/* (removed) Popup för inventarie Export/Import */

/* ---------- Import-popup layout matchar export ---------- */
#importPopup .export-sections { display: flex; flex-direction: column; gap: .5rem; }
#importPopup .export-card { padding: .8rem 1rem; }
#importPopup .export-card + .export-card { margin-top: .4rem; }
#importPopup .export-card .card-desc { display: flex; flex-direction: column; gap: .45rem; text-align: left; }
#importPopup .popup-actions { display: flex; justify-content: flex-end; margin-bottom: .4rem; }
#importPopup .export-card .card-desc p { margin: 0 0 .25rem; }
#importPopup .inline-controls { margin-top: .2rem; }
#importPopup .char-btn { padding: .5rem 1rem; }

/* ---------- Popup för snabb prisjustering ---------- */
#rowPricePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#rowPricePopup.open { display: flex; }
#rowPricePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#rowPricePopup.open .popup-inner { transform: scale(1); }
#rowPricePopup .popup-inner button { width: 100%; }

/* Custom factor row for quick price popup */
#rowPricePopup .price-custom-row {
  display: flex;
  gap: .4rem;
}
#rowPricePopup .price-custom-row input {
  flex: 1;
  min-width: 6rem;
}

/* Matcha import-popupens kortlayout i snabb pris-popup */
#rowPricePopup .export-sections { display: flex; flex-direction: column; gap: .5rem; }
#rowPricePopup .export-card { padding: .8rem 1rem; }
#rowPricePopup .export-card .card-desc { display: flex; flex-direction: column; gap: .45rem; text-align: left; }
#rowPricePopup .inline-controls { margin-top: .2rem; }
#rowPricePopup .money-row {
  display: flex;
  gap: .4rem;
  flex-wrap: wrap;
}
#rowPricePopup .money-row input {
  flex: 1 1 6rem;
  min-width: 4.5rem;
}

/* Döljer upp/ned-pilar i nummerfält i snabbpris-popupen */
#rowPricePopup input[type="number"]::-webkit-outer-spin-button,
#rowPricePopup input[type="number"]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
#rowPricePopup input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

/* ---------- Popup f\u00f6r Nilas-fr\u00e5gan ---------- */
#nilasPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#nilasPopup.open { display: flex; }
#nilasPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#nilasPopup .popup-inner button { width: 100%; }

/* ---------- Popup för karaktärsval ---------- */
#charPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#charPopup.open { display: flex; }
#charPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#charPopup.open .popup-inner { transform: scale(1); }
#charPopup .button-row {
  display: flex;
  gap: .6rem;
}
#charPopup .button-row button {
  flex: 1;
}
#charPopupContent {
  display: flex;
  flex-direction: column;
  gap: .8rem;
}

/* ---------- Popup för Mapphanterare ---------- */
#folderManagerPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#folderManagerPopup.open { display: flex; }
#folderManagerPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  max-width: 480px;
  text-align: left;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#folderManagerPopup .popup-inner button { width: 100%; }

/* Folder manager refined layout */
#folderManagerPopup .popup-inner.folder-ui { gap: 1rem; }
#folderManagerPopup .popup-inner.folder-ui .char-btn { width: auto; }
#folderManagerPopup .popup-inner.folder-ui .mini-btn { width: auto; }
#folderManagerPopup .popup-inner.folder-ui .char-btn.icon { padding: .4rem .6rem; }
#folderManagerPopup .popup-inner.folder-ui .char-btn.neutral { background: var(--border); color: var(--txt); }

#folderManagerPopup .popup-inner.folder-ui .popup-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: .6rem;
}
#folderManagerPopup .popup-inner.folder-ui .popup-header h3 { margin: 0; }

#folderManagerPopup .popup-inner.folder-ui .folder-section h4 {
  margin: 0 0 .2rem;
  color: var(--subtxt);
  font-weight: 600;
}

#folderManagerPopup .popup-inner.folder-ui .inline-row {
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  gap: .6rem .8rem;
}
#folderManagerPopup .popup-inner.folder-ui .inline-row + .inline-row { margin-top: .4rem; }

#folderManagerPopup .popup-inner.folder-ui .inline-controls {
  display: flex;
  gap: .6rem;
  align-items: center;
}

#folderManagerPopup .popup-inner.folder-ui .readonly-field {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: .55rem;
  padding: .45rem .6rem;
  min-height: 2.4rem;
  display: flex;
  align-items: center;
}

/* Character multi-select list in folder manager */
#folderManagerPopup #folderCharList {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: .4rem;
  padding: .2rem;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .55rem;
  /* Make the list span full width of the popup */
  grid-column: 1 / -1;
  width: 100%;
}
#folderManagerPopup #folderCharList .price-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem;
}
#folderManagerPopup #folderCharList .price-item span { flex: 1; }
#folderManagerPopup #folderCharList .price-item span .sub { color: var(--subtxt); font-size: .9em; }
#folderManagerPopup #folderCharList .price-item input[type="checkbox"] {
  appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid var(--card-border);
  border-radius: .25rem;
  background: var(--bg);
  cursor: pointer;
}
#folderManagerPopup #folderCharList .price-item input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

#folderManagerPopup .popup-inner.folder-ui .folder-list {
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .2rem .2rem;
}
#folderManagerPopup .popup-inner.folder-ui .folder-row {
  position: relative;
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: .6rem;
  padding: .45rem .6rem;
}
#folderManagerPopup .popup-inner.folder-ui .folder-row + .folder-row {
  border-top: 1px solid var(--card-border);
}
#folderManagerPopup .popup-inner.folder-ui .folder-name {
  display: inline-flex;
  align-items: center;
  gap: .45rem;
}
#folderManagerPopup .popup-inner.folder-ui .folder-actions {
  display: flex;
  align-items: center;
  gap: .3rem;
  flex-wrap: wrap;
  justify-content: flex-end;
}
#folderManagerPopup .popup-inner.folder-ui .menu-btn {
  background: transparent;
  border: 1px solid var(--card-border);
  color: var(--txt);
  border-radius: .45rem;
  padding: .2rem .5rem;
  cursor: pointer;
}
#folderManagerPopup .popup-inner.folder-ui .menu-btn:hover { background: rgba(255,255,255,.06); }

/* Inline small action buttons replacing "…" menu */
#folderManagerPopup .popup-inner.folder-ui .mini-btn {
  background: var(--accent);
  border: none;
  color: #fff;
  border-radius: .45rem;
  padding: .25rem .5rem;
  cursor: pointer;
  transition: transform .1s ease, opacity .1s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: .25rem;
}
#folderManagerPopup .popup-inner.folder-ui .mini-btn:hover  { opacity: .85; }
#folderManagerPopup .popup-inner.folder-ui .mini-btn:active { transform: scale(.95); opacity: .7; }
#folderManagerPopup .popup-inner.folder-ui .mini-btn.danger {
  background: var(--danger);
  color: #fff;
}
#folderManagerPopup .popup-inner.folder-ui .mini-btn[disabled],
#folderManagerPopup .popup-inner.folder-ui .mini-btn:disabled {
  opacity: .4;
  cursor: default;
  pointer-events: none;
  transform: none;
}

#folderManagerPopup .popup-inner.folder-ui .folder-menu {
  position: absolute;
  right: .6rem;
  top: calc(100% - .2rem);
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: .55rem;
  box-shadow: var(--shadow);
  padding: .35rem;
  display: none;
  z-index: 10;
  min-width: 160px;
}
#folderManagerPopup .popup-inner.folder-ui .folder-menu.open { display: block; }
#folderManagerPopup .popup-inner.folder-ui .folder-menu .char-btn {
  width: 100%;
  padding: .45rem .6rem;
}
#folderManagerPopup .popup-inner.folder-ui .folder-menu .char-btn.danger { background: var(--danger); }
#folderManagerPopup .popup-inner.folder-ui .folder-menu .char-btn.neutral { background: var(--border); color: var(--txt); }

#folderManagerPopup .popup-inner.folder-ui .popup-footer {
  display: flex;
  justify-content: flex-end;
}

/* Gör samtliga popups scrollbara om innehållet blir för högt */
.popup-inner {
  max-height: 100%;
  overflow-y: auto;
}

/* ---------- Generell popup-stil ---------- */
.popup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
.popup.open { display: flex; }
.popup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
.popup.open .popup-inner { transform: scale(1); }
.popup .popup-inner button { width: 100%; }
/* Restyle all "bottom" sheets to centered popups */
.popup-bottom { align-items: center !important; }
.popup-bottom .popup-inner {
  border-radius: 1.2rem !important;
  width: 90% !important;
  transform: scale(.8) !important;
  transition: transform .25s ease !important;
}
.popup-bottom.open .popup-inner { transform: scale(1) !important; }

/* Toast notification */
.toast {
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%);
  background: var(--panel);
  color: var(--txt);
  padding: .6rem 1.2rem;
  border-radius: .6rem;
  box-shadow: 0 4px 10px rgba(0,0,0,.3);
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
  z-index: 4000;
}
.toast.show { opacity: 1; }

/* Clickable price text in inventory */
.card-info-price .price-click {
  appearance: none;
  background: var(--tag-interactive-bg);
  border: 1px solid var(--tag-interactive-border);
  border-radius: .55rem;
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .04), 0 1px 3px rgba(0, 0, 0, .45);
  color: var(--tag-interactive-text);
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font: inherit;
  font-weight: 600;
  gap: .35rem;
  line-height: 1.2;
  padding: .2rem .65rem;
  text-decoration: none;
  text-shadow: 0 1px 1px rgba(0, 0, 0, .35);
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
  white-space: nowrap;
}

.card-info-price .price-click:hover,
.card-info-price .price-click:focus-visible {
  filter: brightness(1.05);
  box-shadow: 0 0 0 1px rgba(255, 255, 255, .25), 0 4px 10px rgba(0, 0, 0, .45);
  transform: translateY(-1px);
  outline: none;
}

.card-info-price .price-click:focus-visible {
  box-shadow: 0 0 0 2px rgba(255, 229, 138, .45), 0 4px 10px rgba(0, 0, 0, .5);
}

.card-info-price .price-click:active {
  filter: brightness(.95);
  transform: scale(.97);
}

/* Rad med två knappar */
.confirm-row {
  display: flex;
  gap: .8rem;
}
.confirm-row button {
  flex: 1;
  width: auto;
}

/* Dialog-popup som ersätter alert/confirm */
#dialogPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#dialogPopup.open .popup-inner { transform: scale(1); }
#dialogPopup .popup-inner button { width: 100%; }

/* Ny/kopia/byt-namn rollperson – matcha standard-popup stil */
#newCharPopup .popup-inner,
#dupCharPopup .popup-inner,
#renameCharPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#newCharPopup.open .popup-inner,
#dupCharPopup.open .popup-inner,
#renameCharPopup.open .popup-inner { transform: scale(1); }

/* Import-popup – tydlig layout i samma stil */
#importPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#importPopup.open .popup-inner { transform: scale(1); }
#importPopup .popup-inner button { width: 100%; }
#importPopup .import-check {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  gap: .6rem;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem;
}
#importPopup .import-check input[type="checkbox"] {
  appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid var(--card-border);
  border-radius: .25rem;
  background: var(--bg);
  cursor: pointer;
}
#importPopup .import-check input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

/* ---------- Form-grid för anteckningar på karaktärsbladet ---------- */
.field-row {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 1rem;
}

.note-field {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.note-field > summary {
  margin-bottom: .4rem;
  color: var(--subtxt);
  font-size: .95rem;
  cursor: pointer;
}

.note-field textarea {
  margin-bottom: .6rem;
}

.form-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.form-group label {
  margin-bottom: .4rem;
  color: var(--subtxt);
  font-size: .95rem;
}

.form-group input,
.form-group textarea {
  margin-bottom: .6rem;
}

/* Textfält som expanderar nedåt */
textarea.auto-resize {
  width: 100%;
  max-width: 100%;
  min-height: 2.6rem;
  resize: none;
  overflow: hidden;
  overflow-wrap: break-word;
}

#background.auto-resize {
  min-height: 8rem;
}

.view-mode .auto-resize {
  display: none;
}

.view-mode .char-btn-row {
  display: none;
}

.note-box {
  width: 100%;
  max-width: 100%;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: 1rem;
  padding: 1rem 1.3rem;
  margin-bottom: .6rem;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  min-height: 2.6rem;
}

/* Knapprad längst ner */
.char-btn-row {
  margin-top: 1.2rem;
}

#notesDisplay {
  white-space: pre-wrap;
}

/* Kontroll för erfarenhetspoäng */
.xp-control {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: .4rem;
  margin-bottom: .6rem;
}

.xp-control input {
  width: 5rem;
  text-align: center;
}

/* Remove default number input spinners so XP is adjusted only via buttons */
.xp-control input::-webkit-outer-spin-button,
.xp-control input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.xp-control input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

#xpSummary {
  margin-top: 0;
}

.cap-row,
.money-line {
  display: flex;
}
.cap-row .label,
.money-line .label {
  flex: 1;
}
.cap-row .value,
.money-line .value {
  flex: 1;
  text-align: right;
  font-variant-numeric: tabular-nums;
}
.cap-neg  { color: var(--danger); }
.cap-warn { color: #f0b429; }
.cap-crit { color: #ff884d; }

.formal-section { margin-bottom: .8rem; }
.formal-section:last-child { margin-bottom: 0; }
.formal-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: 600;
  margin-bottom: .3rem;
}
.money-control { display: flex; gap: .3rem; }
.money-control .char-btn { padding: .3rem .6rem; }
.cap-food { color: var(--txt); }

/* ---------- Popup för tabeller ---------- */
#tabellPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#tabellPopup.open { display: flex; }
#tabellPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem;
  text-align: left;
  width: 90%;
  max-width: 600px;
  max-height: 90vh;
  overflow: auto;
  position: relative;
}
#tabellPopup .popup-inner.wide {
  max-width: min(92vw, 1000px);
}
#tabellPopup .popup-header {
  display: flex;
  align-items: center;
  gap: .6rem;
  margin-bottom: 1rem;
  /* Reserve space so title doesn’t overlap the close button */
  padding-right: 3rem;
}
#tabellPopup .popup-header #tabellActions {
  margin-left: auto;
  display: flex;
  gap: .4rem;
}
#tabellPopup #tabellClose {
  position: absolute;
  top: .8rem;
  right: .8rem;
}
#tabellPopup #tabellTitle {
  margin: 0;
  font-size: 1.2rem;
}
#tabellPopup table {
  border-collapse: collapse;
  width: 100%;
  table-layout: auto;
}
#tabellPopup th,
#tabellPopup td {
  border: 1px solid var(--card-border);
  padding: .3rem .6rem;
  text-align: left;
  word-break: break-word;
}
#tabellPopup th { background: var(--card); }

/* No-wrap mode: prevent all wrapping and breaking */
#tabellPopup .popup-inner.nowrap th,
#tabellPopup .popup-inner.nowrap td {
  white-space: nowrap;
  word-break: normal;
  overflow-wrap: normal;
  hyphens: none;
}

/* Improve readability and navigation */
#tabellPopup .table-wrap {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  position: relative;
}
#tabellPopup .table-wrap::after {
  content: '';
  position: absolute;
  top: 0; right: 0;
  height: 100%; width: 20px;
  pointer-events: none;
  background: linear-gradient(to left, rgba(0,0,0,.18), transparent);
}
#tabellPopup thead th {
  position: sticky;
  top: 0;
  z-index: 1;
  background: var(--card);
}
#tabellPopup tbody tr:nth-child(odd) td {
  background: rgba(255,255,255,.02);
}
#tabellPopup th.num,
#tabellPopup td.num {
  text-align: left;
  font-variant-numeric: tabular-nums;
}
#tabellPopup .table-notes {
  margin-top: .8rem;
  color: var(--subtxt);
  font-size: .95rem;
}

@media (max-width: 600px) {
  #tabellPopup .popup-header #tabellActions {
    display: none;
  }
  #tabellPopup .popup-inner {
    width: 100%;
    height: 100%;
    border-radius: 0;
  }

  /* Mobile stack layout for better readability */
  #tabellPopup table.stack-mobile {
    border: 0;
  }
  #tabellPopup table.stack-mobile thead {
    display: none;
  }
  #tabellPopup table.stack-mobile,
  #tabellPopup table.stack-mobile tbody,
  #tabellPopup table.stack-mobile tr,
  #tabellPopup table.stack-mobile td {
    display: block;
    width: 100%;
  }
  #tabellPopup table.stack-mobile tr {
    border: 1px solid var(--card-border);
    border-radius: .6rem;
    overflow: hidden;
    margin-bottom: .6rem;
    background: transparent;
  }
  #tabellPopup table.stack-mobile td {
    border: 0;
    border-bottom: 1px solid var(--card-border);
    display: grid;
    grid-template-columns: 40% 1fr;
    gap: .6rem;
    padding: .5rem .6rem;
  }
  #tabellPopup table.stack-mobile td:last-child {
    border-bottom: 0;
  }
  #tabellPopup table.stack-mobile td::before {
    content: attr(data-label);
    color: var(--subtxt);
    font-weight: 600;
  }

  #tabellPopup th,
  #tabellPopup td {
    line-height: 1.4;
    font-size: 1rem;
  }

  /* In no-wrap mode, disable stacked mobile layout and restore table semantics */
  #tabellPopup .popup-inner.nowrap table.stack-mobile thead {
    display: table-header-group;
  }
  #tabellPopup .popup-inner.nowrap table.stack-mobile,
  #tabellPopup .popup-inner.nowrap table.stack-mobile tbody {
    display: table;
    width: 100%;
  }
  #tabellPopup .popup-inner.nowrap table.stack-mobile tr {
    display: table-row;
    border: none;
    border-radius: 0;
    margin-bottom: 0;
    background: transparent;
  }
  #tabellPopup .popup-inner.nowrap table.stack-mobile td {
    display: table-cell;
    border: 1px solid var(--card-border);
    padding: .3rem .6rem;
    grid-template-columns: none;
    gap: 0;
  }
  #tabellPopup .popup-inner.nowrap table.stack-mobile td::before {
    content: none;
  }
}

/* ---------- Online modal ---------- */
#onlineModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  z-index: 9999;
}

#onlineModal .modal-panel {
  width: 90%;
  max-width: 520px;
  margin: 10vh auto;
  padding: 1.6rem;
  color: var(--txt);
  max-height: 90vh;
  overflow-y: auto;
}

#onlineModal .modal-actions {
  margin-top: 12px;
  display: flex;
  gap: .5rem;
  justify-content: flex-end;
}

#onlineModal select,
#onlineModal input {
  width: 100%;
}
#artifactPaymentPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#artifactPaymentPopup.open .popup-inner { transform: scale(1); }
#artifactPaymentPopup .popup-inner button { width: 100%; }
#artifactPaymentPopup .button-list {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#artifactPaymentPopup .button-list button.active {
  outline: 2px solid var(--accent);
}
