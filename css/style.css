/* ===========================================================
   css/style.css
   Gemensam styling för index.html, character.html & notes.html
   Optimerad 2025-06-19
   =========================================================== */

/* ---------- Färgpalett ---------- */
:root {
  --bg:          #121416;
  --panel:       #1a1d22;
  --border:      #2d3138;
  --card:        #1f2228;
  --card-border: #353a42;
  --txt:         #f0f0f0;
  --subtxt:      #a0a0a0;
  --accent:      #3d7cff;
  --mystic:      #a64cff;
  --neutral:     #5e9cff;
  --negative:    #8b4513;
  --danger:      #e74c3c;
  --danger-bg:   #3c1a1a;
  --shadow:      0 4px 16px #0007;
}

/* ---------- Reset & grund ---------- */
* { box-sizing: border-box; }
html, body {
  margin: 0;
  padding: 0;
  background: var(--bg);
  color: var(--txt);
  font-family: system-ui, sans-serif;
  line-height: 1.5;
}
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 90px;         /* plats för toolbar */
}

body.menu-open {
  overflow: hidden;
}
shared-toolbar {
  display: block;
}

/* ---------- Generella komponenter ---------- */
h1, h2, h3 { margin: 0 0 .8rem; font-weight: 700; }

.app-title {
  margin: 1.2rem 0 .6rem;
  font-size: 2.4rem;
  letter-spacing: .03em;
  text-align: center;
}

.tags        { display: flex; flex-wrap: wrap; gap: .4rem; }
#activeFilters { margin-bottom: 1rem; }
.tag         { background: var(--border); color: var(--subtxt);
               padding: .15rem .7rem; border-radius: .55rem;
               font-size: .85rem; white-space: nowrap; }
.tag.removable { cursor: pointer; }
.tag.free,
.tag.price-mult { background: var(--accent); color:#fff; }
.tag.mystic    { border: 1.5px solid var(--mystic); }
.tag.neutral   { border: 1.5px solid var(--neutral); }
.tag.negative  { border: 1.5px solid var(--negative); }

.char-btn,
.toolbar button,
.toolbar a {
  padding: .55rem 1.1rem;
  border: none;
  border-radius: .6rem;
  background: var(--accent);
  color: #fff;
  cursor: pointer;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  transition: transform .1s ease, opacity .1s ease;
}
.char-btn.danger { background: var(--danger); }
.char-btn.icon   { font-size: 1.1rem; }
.char-btn:hover  { opacity: .85; }
.char-btn:active { transform: scale(.95); opacity: .7; }

.hidden { display: none; }

/* Knapp för översiktsmeny */
.summary-btn {
  margin-left: auto;
}

/* Innehåll i översiktspanel */
.summary-content {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.summary-section h3 {
  margin: 0 0 .5rem;
  font-size: 1.1rem;
}
.summary-section ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: .3rem;
}

/* Rad för knappar i filterpanelen */
.char-btn-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
  gap: .4rem;
  margin-bottom: .6rem;
}
.char-btn-row.three-col {
  grid-template-columns: repeat(3, minmax(0, 1fr));
}
.char-btn-row.three-col + .char-btn-row.three-col {
  margin-top: 0;
}
.char-btn-row .char-btn {
  width: 100%;
  height: 100%;
}

/* Grupp för partytillhörighet */
.party-toggles {
  padding: 0;
  margin-top: .6rem;
}
.toggle-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
.toggle-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.toggle-desc {
  flex: 1;
  margin-right: .5rem;
  font-size: .95rem;
}

.toggle-question,
.toggle-note {
  display: block;
}

.toggle-question {
  font-weight: 600;
}
.party-toggle {
  padding: .45rem .6rem;
  border-radius: .6rem;
  border: none;
  background: var(--accent);
  color: #fff;
  font-size: 1.2rem;
  cursor: pointer;
  transition: transform .1s ease, opacity .1s ease;
}
.party-toggle:hover  { opacity: .85; }
.party-toggle:active { transform: scale(.95); opacity: .7; }
.party-toggle.active {
  background: var(--danger);
}

/* ---------- Panel (vit/mörk låda) ---------- */
.panel {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  padding: 2rem 1.6rem;
  width: 100%;
  max-width: 520px;
  box-shadow: var(--shadow);
}

.panel-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: .8rem;
  flex-wrap: wrap;
  row-gap: .6rem;
}

.header-actions {
  display: flex;
  gap: .6rem;
}

.panel-header .app-title {
  flex: 1;
  margin: 0;
}

/* ---------- Input/Select ---------- */
input, select, textarea {
  width: 100%;
  padding: .65rem 1rem;
  border-radius: .6rem;
  border: 1.5px solid var(--border);
  background: var(--bg);
  color: var(--txt);
  font-size: 1rem;
}
input:focus, select:focus, textarea:focus {
  outline: none;
  border-color: var(--accent);
}

/* ---------- Kortlista & kort ---------- */
.card-list {
  list-style: none;
  padding: 0;
  margin-top: 1.4rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.cat-group > details > summary {
  font-size: 1.3rem;
  font-weight: 600;
  cursor: pointer;
}

.cat-group .card-list {
  margin-top: .6rem;
}
.card {
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: 1rem;
  padding: 1rem 1.3rem;
  display: flex;
  flex-direction: column;
  gap: .45rem;
  position: relative;
  transition: outline .1s ease, outline-offset .1s ease, box-shadow .1s ease;
}

.card.vehicle-over {
  background: var(--danger-bg);
}

#invList li.card {
  cursor: grab;
  touch-action: pan-y;
  user-select: none;
}
#invList.drag-mode li.card {
  touch-action: none;
}
#invList li.card.dragging {
  cursor: grabbing;
  outline: 3px solid var(--accent);
  outline-offset: 2px;
}

/* särställ "Formaliteter"-kortet med blå kant */
.card[data-special="__formal__"] {
  border: 2px solid var(--accent);
}
.card-title {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  font-size: calc(1.34rem - 2px);
  font-weight: 600;
}
#invList .card-title {
  cursor: pointer;
}
.card-title .title-actions {
  display: flex;
  align-items: center;
  gap: .4rem;
}
.card-title .collapse-btn {
  width: 1rem;
  display: inline-block;
  margin-right: .4rem;
  cursor: pointer;
}
.card-title .collapse-btn::before {
  content: '▼';
}
.card.compact .card-title .collapse-btn::before {
  content: '▶';
}
.xp-cost {
  font-size: .9rem;
  color: var(--subtxt);
  font-weight: 500;
}
.conflict-btn {
  padding: .2rem .5rem;
  font-size: 1.1rem;
}
.card-desc  { font-size: 1.15rem; }
.card.compact .card-desc { display: none; }
.card.compact .inv-controls { display: none; }
#lista .card.compact .inv-controls,
#valda .card.compact .inv-controls {
  display: flex;
}
.card-price {
  position: absolute;
  bottom: 0.6rem;
  left: 1.3rem;
  font-size: .9rem;
  color: var(--subtxt);
}

/* Lista med niva-beskrivningar for formagor */
.levels { margin-top: .6rem; }
.levels dt {
  font-weight: 600;
  background: rgba(255,255,255,0.05);
  padding: .2rem .4rem;
  border-radius: .4rem;
}
.levels dd { margin: 0 0 .4rem 1rem; }

.card button {
  align-self: flex-end;
  background: var(--accent);
  border: none;
  border-radius: .6rem;
  color: #fff;
  padding: .45rem 1.4rem;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform .1s ease, opacity .1s ease;
}
.card button:hover  { opacity: .85; }
.card button:active { transform: scale(.95); opacity: .7; }
.card button.danger { background: var(--danger); }

.inv-controls {
  align-self: flex-end;
  display: flex;
  gap: .4rem;
  flex-wrap: wrap;
  justify-content: flex-end;
}
.inv-controls button {
  align-self: initial;
  flex: 0 0 auto;
  padding: .45rem .6rem;
}

.count-badge {
  margin-left: .3rem;
  background: var(--border);
  color: var(--txt);
  padding: 0 .4rem;
  border-radius: .5rem;
  font-size: .85rem;
}

/* ---------- Fast verktygsrad ---------- */
.toolbar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 900;
  background: var(--panel);
  border-top: 1.5px solid var(--border);
  padding: .6rem .8rem;
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
.toolbar-top {
  display: flex;
  align-items: center;
  gap: .6rem;
}
.toolbar-top input {
  flex: 1 1 110px;
  min-width: 90px;
}
.button-row {
  display: flex;
  gap: .6rem;
}
.button-row > a,
.button-row > button {
  flex: 1;
  min-width: 0;
}

/* Badge för inventarie­knapp */
#invBadge { background: var(--danger); border-radius: 50%;
            padding: 0 .45rem; font-size: .75rem; margin-left: .25rem; }

/* animation when inventory items change */
.inv-flash { animation: invFlash .6s ease-out; }
.rm-flash { animation: rmFlash .6s ease-out; }
@keyframes invFlash {
  0% { background: rgba(61, 124, 255, 0.05); }
  100% { background: var(--card); }
}
@keyframes rmFlash {
  0% { background: rgba(255, 61, 61, 0.05); }
  100% { background: var(--card); }
}

/* pulse effect for inventory badge */
#invBadge.badge-pulse { animation: invBadgePulse .6s ease; }
@keyframes invBadgePulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

/* XP-räknare i verktygsrad */
.toolbar .exp-counter {
  display: flex;
  align-items: center;
  gap: .3rem;
  background: var(--border);
  color: var(--txt);
  padding: .3rem .7rem;
  border-radius: .55rem;
  font-weight: 600;
  font-size: .9rem;
  white-space: nowrap;
}
.toolbar .exp-counter span {
  color: var(--accent);
  font-variant-numeric: tabular-nums;
}

.exp-counter { font-weight: 500; }

/* Rödmarkering för negativa värden */
.exp-counter.under { color: #ff4040; }
.exp-counter.under span { color: inherit; }


/* Specifika paneler använder samma klass plus egna id:n */
#invPanel    { max-width: 420px; }
#filterPanel { max-width: 360px; }
#traitsPanel { max-width: 360px; }
#summaryPanel{ max-width: 360px; }

.inv-header { display: flex; justify-content: space-between; align-items: center; }
.inv-actions { display: flex; align-items: baseline; gap: .4rem; }

/* Knappar i inventariepanelen */
.inv-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: .4rem;
  margin-bottom: 1rem;
}

/* ---------- Pengahantering ---------- */
.money-form {
  display: flex;
  flex-direction: column;
  gap: .6rem;
  margin-top: 1rem;
}
.money-form .money-row {
  display: flex;
  gap: .4rem;
}
.money-form input {
  flex: 1;
  min-width: 6rem;
}

/* ---------- Select nivå ---------- */
select.level {
  align-self: flex-start;
  margin-top: .2rem;
  padding: .3rem .6rem;
  border-radius: .5rem;
  border: 1px solid var(--border);
  background: var(--bg);
  color: var(--txt);
  font-size: .9rem;
}

/* ---------- Karaktärsdrag ---------- */
.traits {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin: 1rem 0;
}
.traits-total {
  margin-top: .5rem;
  font-weight: 600;
}
.traits-total.good  { color: #8fda8c; }
.traits-total.under { color: #ffb0b0; }
.traits-total.over  { color: #ff4040; }
.trait {
  background: var(--card);
  border: 1.5px solid var(--card-border);
  border-radius: .9rem;
  padding: .7rem .6rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: .45rem;
  text-align: center;
}
.trait-controls {
  display: flex;
  align-items: center;
  gap: .6rem;
}
.trait-extra {
  font-size: .78rem;
  color: var(--subtxt);
}
.trait-btn {
  background: var(--border);
  border: 0;
  border-radius: .45rem;
  padding: .15rem .6rem;
  font-size: .82rem;
  cursor: pointer;
  line-height: 1;
  transition: opacity .1s ease, transform .1s ease;
}
.trait-btn:hover  { opacity: .85; }
.trait-btn:active { transform: scale(.94); opacity: .7; }
.trait-value { font-weight: 700; font-size: 1.25rem; }
.trait-name  { font-size: .82rem; color: var(--subtxt); }
.trait-count { font-size: .75rem; color: var(--subtxt); background: none; border: none; padding: 0; cursor: pointer; }

/* ---------- Småskärmar ---------- */
@media (max-width: 420px) {
  .app-title { font-size: 2rem; }
  .panel     { padding: 1.6rem 1.2rem; }
  .toolbar   { padding: .5rem .6rem; gap: .5rem; }
  .toolbar select, .toolbar input { min-width: 80px; }

  .traits      { gap: .7rem; }
  .trait       { padding: .55rem .45rem; }
  .trait-btn   { padding: .1rem .5rem; }
  .trait-value { font-size: 1.15rem; }
  .inv-controls { gap: .25rem; flex-wrap: nowrap; }
  .inv-controls .char-btn {
    padding: .3rem .5rem;
    font-size: .9rem;
  }
  .inv-controls .char-btn[data-elite-req] {
    padding: .15rem .25rem;
    font-size: .45rem;
  }
  .inv-buttons { gap: .3rem; flex-wrap: wrap; }
  .inv-buttons .char-btn {
    padding: .35rem .6rem;
    font-size: .9rem;
  }
  .header-actions {
    gap: .4rem;
  }
  .header-actions .char-btn.icon {
    padding: .35rem .6rem;
    font-size: .9rem;
  }
}
/* ---------- Off-canvas-paneler från höger ---------- */
#invPanel,
#filterPanel,
#traitsPanel,
#yrkePanel,
#infoPanel,
#summaryPanel,
#conflictPanel {
  position: fixed;
  top: 0;
  right: -100%;
  width: 80%;
  /* max-width för olika paneler: */
  /* invPanel   → 420px, filterPanel & traitsPanel → 360px */
  max-width: none; /* vi sätter nedan individuellt */
  height: 100%;
  background: var(--panel);
  box-shadow: -4px 0 20px #0009;
  transition: right .25s ease;
  z-index: 1000;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding: 1.2rem 1rem 2rem;
  font-size: 1rem;
}

/* Specifika max-breddar */
#invPanel    { max-width: 420px; }
#filterPanel { max-width: 360px; }
#traitsPanel { max-width: 360px; }
#summaryPanel{ max-width: 360px; }
#conflictPanel { max-width: 360px; }
#yrkePanel   { max-width: 360px; font-size: 1.2rem; line-height: 1.6; }
#infoPanel   { max-width: 360px; font-size: 1.1rem; line-height: 1.5; }
#yrkePanel p { margin: 0 0 1rem; }
#yrkePanel table {
  width: 100%;
  border-collapse: collapse;
  margin: .5rem 0 1rem;
}
#yrkePanel th,
#yrkePanel td {
  border: 1px solid var(--card-border);
  padding: .3rem .6rem;
  text-align: left;
}
#yrkePanel th {
  background: var(--card);
}
#infoPanel p { margin: 0 0 1rem; }

/* När klassen .open läggs på – låt panelen glida in */
#invPanel.open,
#filterPanel.open,
#traitsPanel.open,
#yrkePanel.open,
#infoPanel.open,
#summaryPanel.open,
#conflictPanel.open {
  right: 0;
}

@media (min-width: 1024px) {
  #invPanel    { max-width: 520px; }
  #filterPanel { max-width: 460px; }
  #traitsPanel { max-width: 460px; }
  #summaryPanel{ max-width: 460px; }
  #conflictPanel{ max-width: 460px; }
  #yrkePanel   { max-width: 520px; }
  #infoPanel   { max-width: 520px; }
}

/* ---------- Popup för kvaliteter ---------- */
#qualPopup {
  position: fixed;
  inset: 0;                    /* top/right/bottom/left:0 */
  width: 100%;
  height: 100%;
  display: none;               /* ← döljs tills .open */
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);  /* lite mörkare för tydlighet */
  z-index: 3000;               /* över alla paneler */
}
#qualPopup.open {              /* sätts av JS */
  display: flex;
}
#qualPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#qualPopup #qualOptions {
  display: flex;
  flex-direction: column;
  gap: .5rem;
}
#qualPopup .popup-inner h3 {
  margin: 0;
}
#qualPopup .popup-inner button {
  width: 100%;
}
/* ---------- Popup för mästarnivå ---------- */
#masterPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#masterPopup.open {
  display: flex;
}
#masterPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
}
#masterPopup.open .popup-inner {
  transform: translateY(0);
}
#masterPopup .popup-inner h3 {
  margin-top: 0;
}
#masterPopup #masterOpts {
  display: flex;
  flex-direction: column;
  gap: .5rem;
  margin-top: .5rem;
}
#masterPopup #masterOpts label {
  display: flex;
  flex-direction: column;
  text-align: left;
  gap: .25rem;
}
#masterPopup .or-group {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: .5rem;
  padding-left: .8rem;
  margin-left: .4rem;
}
#masterPopup .or-group::before {
  content: '';
  position: absolute;
  left: -.4rem;
  top: .2rem;
  bottom: .2rem;
  width: .4rem;
  border-left: 2px solid var(--subtxt);
  border-top: 2px solid var(--subtxt);
  border-bottom: 2px solid var(--subtxt);
  border-radius: .4rem 0 0 .4rem;
}
#masterPopup .or-sep {
  text-align: center;
  color: var(--subtxt);
  font-style: italic;
  font-size: .85rem;
}
#masterPopup #masterBtns {
  display: flex;
  flex-direction: column;
  gap: .6rem;
  margin-top: .6rem;
}
#masterPopup #masterBtns button { width: 100%; }
#masterPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r Exceptionellt karakt\u00e4rsdrag ---------- */
#traitPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#traitPopup.open { display: flex; }
#traitPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#traitPopup.open .popup-inner { transform: translateY(0); }
#traitPopup #traitOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#traitPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r Djurmask ---------- */
#maskPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#maskPopup.open { display: flex; }
#maskPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#maskPopup.open .popup-inner { transform: translateY(0); }
#maskPopup #maskOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#maskPopup .popup-inner button { width: 100%; }
/* ---------- Popup för hamnskifteform ---------- */
#beastPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#beastPopup.open { display: flex; }
#beastPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#beastPopup.open .popup-inner { transform: translateY(0); }
#beastPopup #beastOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#beastPopup .popup-inner button { width: 100%; }


/* ---------- Popup f\u00f6r blodsband ---------- */
#bloodPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#bloodPopup.open { display: flex; }
#bloodPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#bloodPopup.open .popup-inner { transform: translateY(0); }
#bloodPopup #bloodOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#bloodPopup .popup-inner button { width: 100%; }

/* ---------- Popup för Monsterlärd ---------- */
#monsterPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#monsterPopup.open { display: flex; }
#monsterPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#monsterPopup.open .popup-inner { transform: translateY(0); }
#monsterPopup #monsterOpts {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#monsterPopup .popup-inner button { width: 100%; }

/* ---------- Popup för eget föremål ---------- */
#customPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#customPopup.open { display: flex; }
#customPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#customPopup.open .popup-inner { transform: translateY(0); }
#customPopup .popup-inner button { width: 100%; }

/* ---------- Popup för pengar ---------- */
#moneyPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#moneyPopup.open { display: flex; }
#moneyPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#moneyPopup.open .popup-inner { transform: translateY(0); }
#moneyPopup .popup-inner button { width: 100%; }

/* ---------- Popup Spara & Gratis ---------- */
#saveFreePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#saveFreePopup.open { display: flex; }
#saveFreePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#saveFreePopup.open .popup-inner { transform: scale(1); }
#saveFreePopup .popup-inner button { width: 100%; }
#saveFreePopup .confirm-row {
  display: flex;
  gap: .8rem;
}
#saveFreePopup .confirm-row button {
  flex: 1;
  width: auto;
}

/* ---------- Popup Varning Fördelspengar ---------- */
#advMoneyPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#advMoneyPopup.open { display: flex; }
#advMoneyPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#advMoneyPopup .confirm-row {
  display: flex;
  gap: .8rem;
}
#advMoneyPopup .confirm-row button {
  flex: 1;
  width: auto;
}

/* ---------- Popup för antal ---------- */
#qtyPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#qtyPopup.open { display: flex; }
#qtyPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#qtyPopup.open .popup-inner { transform: translateY(0); }
#qtyPopup .popup-inner button { width: 100%; }
#qtyItemList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}

/* ---------- Popup för pris ---------- */
#pricePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#pricePopup.open { display: flex; }
#pricePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#pricePopup.open .popup-inner { transform: translateY(0); }
#pricePopup .popup-inner button { width: 100%; }
#priceItemList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
#priceItemList .price-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem;
}
#priceItemList .price-item span {
  flex: 1;
}
#priceItemList .price-item input[type="checkbox"] {
  appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid var(--card-border);
  border-radius: .25rem;
  background: var(--bg);
  cursor: pointer;
}
#priceItemList .price-item input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

/* ---------- Popup för färdmedel ---------- */
#vehiclePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#vehiclePopup.open { display: flex; }
#vehiclePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#vehiclePopup.open .popup-inner { transform: translateY(0); }
#vehiclePopup .popup-inner button { width: 100%; }
#vehicleItemList {
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
#vehicleItemList .price-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem;
}
#vehicleItemList .price-item span {
  flex: 1;
}
#vehicleItemList .price-item input[type="checkbox"] {
  appearance: none;
  width: 1.1rem;
  height: 1.1rem;
  border: 2px solid var(--card-border);
  border-radius: .25rem;
  background: var(--bg);
  cursor: pointer;
}
#vehicleItemList .price-item input[type="checkbox"]:checked {
  background: var(--accent);
  border-color: var(--accent);
}

.vehicle-group {
  position: relative;
  border: 2px solid var(--card-border);
  border-radius: .6rem;
  padding: .4rem .6rem .6rem;
  display: flex;
  flex-direction: column;
  gap: .4rem;
}
.vehicle-group .vehicle-icon {
  position: absolute;
  top: .2rem;
  right: .4rem;
}

/* ---------- Popup för borttagning av behållare ---------- */
#deleteContainerPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#deleteContainerPopup.open { display: flex; }
#deleteContainerPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#deleteContainerPopup.open .popup-inner { transform: translateY(0); }
#deleteContainerPopup .popup-inner button { width: 100%; }

/* ---------- Popup för alkemistnivå ---------- */
#alcPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#alcPopup.open { display: flex; }
#alcPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#alcPopup.open .popup-inner { transform: translateY(0); }
#alcPopup #alcOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#alcPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r smedsniv\u00e5 ---------- */
#smithPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#smithPopup.open { display: flex; }
#smithPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#smithPopup.open .popup-inner { transform: translateY(0); }
#smithPopup #smithOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#smithPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r artefaktmakarniv\u00e5 ---------- */
#artPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#artPopup.open { display: flex; }
#artPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#artPopup.open .popup-inner { transform: translateY(0); }
#artPopup #artOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#artPopup .popup-inner button { width: 100%; }

/* ---------- Popup för försvarskaraktärsdrag ---------- */
#defensePopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: flex-end;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#defensePopup.open { display: flex; }
#defensePopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem 1.2rem 0 0;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: translateY(100%);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#defensePopup.open .popup-inner { transform: translateY(0); }
#defensePopup #defenseOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#defensePopup .popup-inner button { width: 100%; }

/* ---------- Popup för export ---------- */
#exportPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#exportPopup.open { display: flex; }
#exportPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#exportOptions {
  display: flex;
  flex-direction: column;
  gap: .6rem;
}
#exportPopup .popup-inner button { width: 100%; }

/* ---------- Popup f\u00f6r Nilas-fr\u00e5gan ---------- */
#nilasPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#nilasPopup.open { display: flex; }
#nilasPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#nilasPopup .popup-inner button { width: 100%; }

/* ---------- Popup för karaktärsval ---------- */
#charPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#charPopup.open { display: flex; }
#charPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 100%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#charPopup.open .popup-inner { transform: scale(1); }
#charPopup .popup-inner button { width: 100%; }
#charPopupContent {
  display: flex;
  flex-direction: column;
  gap: .8rem;
}

/* Gör samtliga popups scrollbara om innehållet blir för högt */
.popup-inner {
  max-height: 100%;
  overflow-y: auto;
}

/* ---------- Generell popup-stil ---------- */
.popup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
.popup.open { display: flex; }
.popup-bottom { align-items: flex-end; }

/* Rad med två knappar */
.confirm-row {
  display: flex;
  gap: .8rem;
}
.confirm-row button {
  flex: 1;
  width: auto;
}

/* Dialog-popup som ersätter alert/confirm */
#dialogPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem 1.4rem 2rem;
  width: 90%;
  max-width: 420px;
  text-align: center;
  transform: scale(.8);
  transition: transform .25s ease;
  display: flex;
  flex-direction: column;
  gap: .8rem;
}
#dialogPopup.open .popup-inner { transform: scale(1); }
#dialogPopup .popup-inner button { width: 100%; }

/* ---------- Form-grid för anteckningar på karaktärsbladet ---------- */
.field-row {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  margin-bottom: 1rem;
}

.note-field {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.note-field > summary {
  margin-bottom: .4rem;
  color: var(--subtxt);
  font-size: .95rem;
  cursor: pointer;
}

.note-field textarea {
  margin-bottom: .6rem;
}

.form-group {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

.form-group label {
  margin-bottom: .4rem;
  color: var(--subtxt);
  font-size: .95rem;
}

.form-group input,
.form-group textarea {
  margin-bottom: .6rem;
}

/* Textfält som expanderar nedåt */
textarea.auto-resize {
  width: 100%;
  max-width: 100%;
  min-height: 2.6rem;
  resize: none;
  overflow: hidden;
  overflow-wrap: break-word;
}

#background.auto-resize {
  min-height: 8rem;
}

.view-mode .auto-resize {
  display: none;
}

.view-mode .char-btn-row {
  display: none;
}

.note-box {
  width: 100%;
  max-width: 100%;
  background: var(--card);
  border: 2px solid var(--card-border);
  border-radius: 1rem;
  padding: 1rem 1.3rem;
  margin-bottom: .6rem;
  white-space: pre-wrap;
  overflow-wrap: break-word;
  min-height: 2.6rem;
}

/* Knapprad längst ner */
.char-btn-row {
  margin-top: 1.2rem;
}

#notesDisplay {
  white-space: pre-wrap;
}

/* Kontroll för erfarenhetspoäng */
.xp-control {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: .4rem;
  margin-bottom: .6rem;
}

.xp-control input {
  width: 5rem;
  text-align: center;
}

/* Remove default number input spinners so XP is adjusted only via buttons */
.xp-control input::-webkit-outer-spin-button,
.xp-control input::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

.xp-control input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
}

#xpSummary {
  margin-top: .6rem;
}

.cap-row,
.money-line {
  display: flex;
}
.cap-row .label,
.money-line .label {
  flex: 1;
}
.cap-row .value,
.money-line .value {
  flex: 1;
  text-align: right;
  font-variant-numeric: tabular-nums;
}
.cap-neg { color: var(--danger); }

.formal-section { margin-bottom: .8rem; }
.formal-section:last-child { margin-bottom: 0; }
.formal-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-weight: 600;
  margin-bottom: .3rem;
}
.money-control { display: flex; gap: .3rem; }
.money-control .char-btn { padding: .3rem .6rem; }
.cap-food { color: var(--txt); }

/* ---------- Popup för tabeller ---------- */
#tabellPopup {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.6);
  z-index: 3000;
}
#tabellPopup.open { display: flex; }
#tabellPopup .popup-inner {
  background: var(--panel);
  border: 1.5px solid var(--border);
  border-radius: 1.2rem;
  box-shadow: var(--shadow);
  padding: 1.5rem;
  width: 90%;
  max-width: 600px;
  max-height: 90vh;
  overflow: auto;
  position: relative;
}
#tabellPopup .popup-header {
  display: flex;
  align-items: center;
  gap: .6rem;
  margin-bottom: 1rem;
}
#tabellPopup #tabellClose { flex-shrink: 0; }
#tabellPopup #tabellTitle {
  margin: 0;
  font-size: 1.2rem;
}
#tabellPopup table {
  border-collapse: collapse;
  width: 100%;
  table-layout: auto;
}
#tabellPopup th,
#tabellPopup td {
  border: 1px solid var(--card-border);
  padding: .3rem .6rem;
  text-align: left;
  word-break: break-word;
}
#tabellPopup th { background: var(--card); }

@media (max-width: 600px) {
  #tabellPopup .popup-inner {
    width: 100%;
    height: 100%;
    border-radius: 0;
  }

  #tabellPopup table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }

  #tabellPopup th,
  #tabellPopup td {
    line-height: 1.4;
    font-size: 1rem;
  }
}

/* ---------- Online modal ---------- */
#onlineModal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  z-index: 9999;
}

#onlineModal .modal-panel {
  width: 90%;
  max-width: 520px;
  margin: 10vh auto;
  padding: 1.6rem;
  color: var(--txt);
  max-height: 90vh;
  overflow-y: auto;
}

#onlineModal .modal-actions {
  margin-top: 12px;
  display: flex;
  gap: .5rem;
  justify-content: flex-end;
}

#onlineModal select,
#onlineModal input {
  width: 100%;
}

